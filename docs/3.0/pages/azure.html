<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Azure Bridge &mdash; OEI Documentation v1.0 documentation</title><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
      <link rel="stylesheet" href="../_static/contentui.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/contentui.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="OpcuaExport Application" href="opcua.html" />
    <link rel="prev" title="Working with Time series Data" href="timeseries.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> OEI Documentation
          </a>
              <div class="version">
                3.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> OEI</span>
      v: 3.0
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Document Versions</dt>
        
          <dd><a href="/3.0/">3.0</a></dd>
        
          <dd><a href="/2.6/">2.6</a></dd>
        
      </dl>
    </div>
  </div>
  
              <p><span class="caption-text">Introduction:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction to OEI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#terminology">Terminology</a><ul>
<li class="toctree-l3"><a class="reference internal" href="introduction.html#general-terminology">General Terminology</a></li>
<li class="toctree-l3"><a class="reference internal" href="introduction.html#security-related-terminology">Security-Related Terminology</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="min-system-requirements.html">Minimum system requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Run Open Edge Insights</a><ul>
<li class="toctree-l2"><a class="reference internal" href="running.html#install-open-edge-insights-from-github">Install Open Edge Insights from GitHub</a><ul>
<li class="toctree-l3"><a class="reference internal" href="running.html#task-1-get-oei-codebase-from-github">Task 1: Get OEI codebase from GitHub</a></li>
<li class="toctree-l3"><a class="reference internal" href="running.html#task-2-install-prerequisites">Task 2: Install prerequisites</a><ul>
<li class="toctree-l4"><a class="reference internal" href="running.html#run-the-pre-requisite-script">Run the pre-requisite script</a></li>
<li class="toctree-l4"><a class="reference internal" href="running.html#optional-steps">Optional steps</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="running.html#task-3-generate-deployment-and-configuration-files">Task 3: Generate deployment and configuration files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="running.html#use-the-builder-script">Use the Builder script</a></li>
<li class="toctree-l4"><a class="reference internal" href="running.html#generate-consolidated-files-for-all-applicable-oei-services">Generate consolidated files for all applicable OEI services</a></li>
<li class="toctree-l4"><a class="reference internal" href="running.html#generate-consolidated-files-for-a-subset-of-oei-services">Generate consolidated files for a subset of OEI services</a></li>
<li class="toctree-l4"><a class="reference internal" href="running.html#generate-multi-instance-configs-using-the-builder">Generate multi-instance configs using the Builder</a></li>
<li class="toctree-l4"><a class="reference internal" href="running.html#generate-benchmarking-configs-using-builder">Generate benchmarking configs using Builder</a></li>
<li class="toctree-l4"><a class="reference internal" href="running.html#add-oei-services">Add OEI services</a></li>
<li class="toctree-l4"><a class="reference internal" href="running.html#distribute-the-oei-container-images">Distribute the OEI container images</a></li>
<li class="toctree-l4"><a class="reference internal" href="running.html#list-of-oei-services">List of OEI services</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="running.html#task-4-build-and-run-the-oei-video-and-time-series-use-cases">Task 4: Build and run the OEI video and time series use cases</a><ul>
<li class="toctree-l4"><a class="reference internal" href="running.html#build-the-oei-stack">Build the OEI stack</a></li>
<li class="toctree-l4"><a class="reference internal" href="running.html#run-oei-services">Run OEI services</a></li>
<li class="toctree-l4"><a class="reference internal" href="running.html#push-the-required-oei-images-to-docker-registry">Push the required OEI images to docker registry</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="running.html#web-deployment-tool">Web Deployment Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="running.html#video-pipeline-analytics">Video pipeline analytics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="running.html#enable-camera-based-video-ingestion">Enable camera-based video ingestion</a></li>
<li class="toctree-l3"><a class="reference internal" href="running.html#use-video-accelerators-in-ingestion-and-analytics-containers">Use video accelerators in ingestion and analytics containers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="running.html#to-run-on-usb-devices">To run on USB devices</a></li>
<li class="toctree-l4"><a class="reference internal" href="running.html#to-run-on-myriad-devices">To run on MYRIAD devices</a></li>
<li class="toctree-l4"><a class="reference internal" href="running.html#to-run-on-hddl-devices">To run on HDDL devices</a></li>
<li class="toctree-l4"><a class="reference internal" href="running.html#to-run-on-intel-r-processor-graphics-gpu-igpu">To run on Intel(R) Processor Graphics (GPU/iGPU)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="running.html#custom-user-defined-functions">Custom User Defined Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="running.html#time-series-analytics">Time series analytics</a></li>
<li class="toctree-l2"><a class="reference internal" href="running.html#oei-multi-node-cluster-deployment">OEI multi-node cluster deployment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="running.html#with-k8s-orchestrator">With k8s orchestrator</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="running.html#oei-uninstaller">OEI Uninstaller</a></li>
<li class="toctree-l2"><a class="reference internal" href="running.html#debugging-options">Debugging options</a></li>
<li class="toctree-l2"><a class="reference internal" href="running.html#troubleshooting-guide">Troubleshooting guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="release.html">Release Notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="release.html#eii-v2-6-3">EII v2.6.3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="release.html#fixes">Fixes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="release.html#oei-v3-0">OEI v3.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="release.html#new-features">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="release.html#dropped-features">Dropped Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="release.html#known-issues">Known Issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="release.html#eii-v2-6-2">EII v2.6.2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="release.html#id1">Fixes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="release.html#eii-v2-6-1">EII v2.6.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="release.html#bug-fixes">Bug fixes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="release.html#eii-v2-6">EII v2.6</a><ul>
<li class="toctree-l3"><a class="reference internal" href="release.html#features">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="release.html#id2">Known Issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="release.html#eii-v2-5-3">EII v2.5.3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="release.html#id4">Fixes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="release.html#eii-v2-5-2">EII v2.5.2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="release.html#id5">Bug fixes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="release.html#eii-v2-5-1">EII v2.5.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="release.html#bug-fix">Bug fix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="release.html#eii-v2-5">EII v2.5</a><ul>
<li class="toctree-l3"><a class="reference internal" href="release.html#id6">Features</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><span class="caption-text">Core Libraries:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="msgbus.html">Message Bus</a><ul>
<li class="toctree-l2"><a class="reference internal" href="msgbus.html#id1">Message Bus</a><ul>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#dependency-installation">Dependency Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#compilation">Compilation</a></li>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#generating-documentation">Generating Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#potential-compilation-issues">Potential Compilation Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#packaging">Packaging</a><ul>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#a-note-on-alpine-apk-packaging">A Note on Alpine APK Packaging</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#installation">Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#install-python-binding">Install Python Binding</a></li>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#install-golang-binding">Install Golang Binding</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#running-unit-tests">Running Unit Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#configuration">Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#zeromq-ipc-configuration">ZeroMQ IPC Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#zeromq-tcp-configuration">ZeroMQ TCP Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#additional-zeromq-configuration-properties">Additional ZeroMQ Configuration Properties</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#example-usage">Example Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#c-examples">C Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#python-examples">Python Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#go-examples">Go Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#running-go-examples-without-installing">Running Go Examples without Installing</a></li>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#brokered-publish-subscribe">Brokered Publish/Subscribe</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#security">Security</a><ul>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#using-only-curvezmq-encryption">Using Only CurveZMQ Encryption</a></li>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#id2">Using ZAP Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#disabling-security">Disabling Security</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#known-issues">Known issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#generation-of-python-whl-file-optional">Generation of python .whl file (Optional)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="msgbus.html#id3">Dependency Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="msgbus.html#id4">Compilation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#id5">Generating Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#id6">Potential Compilation Issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="msgbus.html#id7">Packaging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#id9">A Note on Alpine APK Packaging</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="msgbus.html#id10">Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#id11">Install Python Binding</a></li>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#id12">Install Golang Binding</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="msgbus.html#id13">Running Unit Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="msgbus.html#id14">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#id15">ZeroMQ IPC Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#id16">ZeroMQ TCP Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#id17">Publishers</a></li>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#id18">Subscribers</a></li>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#id19">Services</a></li>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#id20">Requesters</a></li>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#id21">Using ZAP Authentication</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#id22">Additional ZeroMQ Configuration Properties</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="msgbus.html#id23">Example Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#id24">C Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#id25">Publisher Many Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#id26">Python Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#id27">Go Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#id28">Running Go Examples without Installing</a></li>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#id29">Brokered Publish/Subscribe</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="msgbus.html#id30">Security</a><ul>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#id33">Using Only CurveZMQ Encryption</a><ul>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#id34">Publish/Subscribe</a></li>
<li class="toctree-l4"><a class="reference internal" href="msgbus.html#id35">Request/Response</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#id36">Using ZAP Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="msgbus.html#id37">Disabling Security</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="msgbus.html#id38">Known issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="msgbus.html#id39">Generation of python .whl file (Optional)</a></li>
<li class="toctree-l2"><a class="reference internal" href="msgbus.html#api-documentation">API Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="eiiConfig.html">OEI Configuration Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="eiiConfig.html#configmgr">ConfigMgr</a><ul>
<li class="toctree-l3"><a class="reference internal" href="eiiConfig.html#configmgr-installation">ConfigMgr Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="eiiConfig.html#using-system-grpc">Using System gRPC</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="eiiConfig.html#compilation">Compilation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="eiiConfig.html#generating-documentation">Generating Documentation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="eiiConfig.html#packaging">Packaging</a><ul>
<li class="toctree-l4"><a class="reference internal" href="eiiConfig.html#a-note-on-alpine-apk-packaging">A Note on Alpine APK Packaging</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="eiiConfig.html#interfaces">Interfaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="eiiConfig.html#publisher-interface">Publisher Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="eiiConfig.html#subscriber-interface">Subscriber Interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="eiiConfig.html#server-interface"><strong>Server Interface</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="eiiConfig.html#client-interface"><strong>Client Interface</strong></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="eiiConfig.html#overriding-of-type-and-endpoint">Overriding of Type and EndPoint</a></li>
<li class="toctree-l3"><a class="reference internal" href="eiiConfig.html#broker-usecase">Broker Usecase</a></li>
<li class="toctree-l3"><a class="reference internal" href="eiiConfig.html#running-examples">Running Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="eiiConfig.html#cpp-examples">CPP Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="eiiConfig.html#python-examples">Python Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="eiiConfig.html#go-examples">Go Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="eiiConfig.html#running-unit-tests">Running Unit Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="eiiConfig.html#creation-of-grpc-zip-file-optional">Creation of grpc .zip file (Optional)</a></li>
<li class="toctree-l3"><a class="reference internal" href="eiiConfig.html#generation-of-python-whl-file-optional">Generation of python .whl file (Optional)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="eiiConfig.html#etcd-ui-service">ETCD UI Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="eiiConfig.html#api-documentation">API Documentation</a></li>
</ul>
</li>
</ul>
<p><span class="caption-text">Video Analytics Pipeline:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="video.html">Working with Video Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="video.html#videoingestion-module">VideoIngestion module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="video.html#configuration">Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="video.html#ingestor-config">Ingestor config</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="video.html#videoingestion-features">VideoIngestion features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="video.html#image-ingestion">Image ingestion</a></li>
<li class="toctree-l4"><a class="reference internal" href="video.html#udf-configurations">UDF configurations</a></li>
<li class="toctree-l4"><a class="reference internal" href="video.html#updating-security-context-of-videoingestion-helm-charts-for-enabling-k8s-environment-to-access-detect-basler-usb-device">Updating Security Context of VideoIngestion Helm Charts for enabling K8s environment to access/detect Basler/usb Device</a></li>
<li class="toctree-l4"><a class="reference internal" href="video.html#camera-configurations">Camera configurations</a></li>
<li class="toctree-l4"><a class="reference internal" href="video.html#rtsp-cameras">RTSP cameras</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="video.html#videoanalytics-module">VideoAnalytics Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="video.html#id5">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="video.html#id14">Updating Security Context of VideoIngestion Helm Charts for enabling K8s environment to access/detect Basler/usb Device</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="video.html#using-video-accelerators-in-ingestion-analytics-containers">Using video accelerators in ingestion/analytics containers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="video.html#to-run-on-usb-devices"><strong>To run on USB devices</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="video.html#to-run-on-myriad-devices"><strong>To run on MYRIAD devices</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="video.html#to-run-on-hddl-devices"><strong>To run on HDDL devices</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="video.html#to-run-on-intel-r-processor-graphics-gpu-igpu"><strong>To run on Intel(R) Processor Graphics (GPU/iGPU)</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="video.html#oei-udfloader">OEI UDFLoader</a></li>
<li class="toctree-l2"><a class="reference internal" href="video.html#oei-sample-udfs">OEI Sample UDFs</a></li>
<li class="toctree-l2"><a class="reference internal" href="video.html#user-defined-function-udf">User Defined Function (UDF)</a></li>
<li class="toctree-l2"><a class="reference internal" href="video.html#native-visualizer-module">Native Visualizer Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="video.html#steps-to-build-and-run-visualizer">Steps to build and run visualizer</a></li>
<li class="toctree-l3"><a class="reference internal" href="video.html#using-labels">Using Labels</a></li>
<li class="toctree-l3"><a class="reference internal" href="video.html#metadata-structure">Metadata Structure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="video.html#web-visualizer-module">Web Visualizer Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="video.html#steps-to-build-and-run-web-visualizer">Steps to build and run web visualizer</a></li>
<li class="toctree-l3"><a class="reference internal" href="video.html#id28">Using Labels</a><ul>
<li class="toctree-l4"><a class="reference internal" href="video.html#id32">Metadata Structure</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="video.html#imagestore-module">ImageStore Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="video.html#id33">Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="video.html#detailed-description-on-each-of-the-keys-used">Detailed description on each of the keys used</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="video.html#influxdbconnector-module">InfluxDBConnector Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="video.html#id35">Configuration</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="video.html#working-with-edge-video-analytics-microservice">Working with Edge Video Analytics Microservice</a><ul>
<li class="toctree-l2"><a class="reference internal" href="video.html#edge-video-analytics-microservice">Edge Video Analytics Microservice</a><ul>
<li class="toctree-l3"><a class="reference internal" href="video.html#build-the-base-image">Build the base image</a></li>
<li class="toctree-l3"><a class="reference internal" href="video.html#run-the-base-image">Run the base image</a></li>
<li class="toctree-l3"><a class="reference internal" href="video.html#run-evam-in-oei-mode">Run EVAM in OEI mode</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><span class="caption-text">Time-Series Analytics Pipeline:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="timeseries.html">Working with Time series Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="timeseries.html#telegraf">Telegraf</a><ul>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#telegraf-s-default-configuration">Telegraf’s default configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#mqtt-sample-configuration-and-tool-to-test-it">MQTT sample configuration and tool to test it</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#enabling-message-bus-input-plugin-in-telegraf">Enabling message bus input plugin in Telegraf</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#advanced-multiple-plugin-sections-of-oei-message-bus-input-plugin">Advanced: Multiple plugin sections of OEI message bus input plugin</a><ul>
<li class="toctree-l4"><a class="reference internal" href="timeseries.html#using-input-plugin">Using input plugin</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#enabling-message-bus-output-plugin-in-telegraf">Enabling message bus Output plugin in Telegraf</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#advanced-multiple-plugin-sections-of-message-bus-output-plugin">Advanced: Multiple plugin sections of message bus output plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#run-telegraf-input-output-plugin-in-ipc-mode">Run Telegraf Input output plugin in IPC mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#optional-adding-multiple-telegraf-instances">Optional: Adding multiple telegraf instances</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="timeseries.html#point-data-time-series-data-analytics-introduction">Point-data (Time series data) analytics introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#starting-the-example">Starting the example</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#purpose-of-telegraf">Purpose of Telegraf</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#purpose-of-kapacitor">Purpose of Kapacitor</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#custom-udfs-available-in-the-udfs-directory">Custom UDFs available in the udfs directory</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#steps-to-configure-the-udfs-in-kapacitor">Steps to configure the UDFs in Kapacitor</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#steps-to-run-the-samples-of-multiple-udfs-in-a-single-task-and-multiple-tasks-using-single-udf">Steps to run the samples of multiple UDFs in a single task and multiple tasks using single UDF</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#kapacitor-input-and-output-plugins">Kapacitor input and output plugins</a><ul>
<li class="toctree-l4"><a class="reference internal" href="timeseries.html#purpose-of-plugins">Purpose of plugins</a></li>
<li class="toctree-l4"><a class="reference internal" href="timeseries.html#id54">Using input plugin</a></li>
<li class="toctree-l4"><a class="reference internal" href="timeseries.html#using-output-plugin">Using output plugin</a></li>
<li class="toctree-l4"><a class="reference internal" href="timeseries.html#using-input-output-plugin-with-rfc-udf">Using input/output plugin with RFC UDF</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="timeseries.html#grafana">Grafana</a><ul>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#configuration">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#run-grafana">Run Grafana</a><ul>
<li class="toctree-l4"><a class="reference internal" href="timeseries.html#run-grafana-in-the-prod-mode">Run Grafana in the PROD mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="timeseries.html#run-grafana-in-the-dev-mode">Run Grafana in the DEV mode</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#execute-queries">Execute queries</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#run-grafana-for-video-use-cases">Run Grafana for video use cases</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="timeseries.html#influxdbconnector-module">InfluxDBConnector Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#id66">Configuration</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><span class="caption-text">Export Services:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Azure Bridge</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prerequisites-and-setup">Prerequisites and Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#azure-cloud-setup">Azure Cloud Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#setting-up-azureml">Setting up AzureML</a></li>
<li class="toctree-l4"><a class="reference internal" href="#important">Important</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#development-system-setup">Development System Setup</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#build-and-push-oei-containers">Build and Push OEI Containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#single-node-azure-iot-edge-deployment">Single-Node Azure IoT Edge Deployment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-1-provisioning">Step 1 - Provisioning</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-configuring-oei">Step 2 - Configuring OEI</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-3-configuring-azure-iot-deployment-manifest">Step 3 - Configuring Azure IoT Deployment Manifest</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-4-deployment">Step 4 - Deployment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#helpful-debugging-commands">Helpful Debugging Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="#final-notes">Final Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">Azure Bridge</a></li>
<li class="toctree-l3"><a class="reference internal" href="#zeromq-tcp-subscription-implications">ZeroMQ TCP Subscription Implications</a></li>
<li class="toctree-l3"><a class="reference internal" href="#zeromq-ipc-subscription-implications">ZeroMQ IPC Subscription Implications</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sample-oei-onnx-udf">Sample OEI ONNX UDF</a></li>
<li class="toctree-l3"><a class="reference internal" href="#simple-subscriber">Simple Subscriber</a></li>
<li class="toctree-l3"><a class="reference internal" href="#oei-etcd-pre-load">OEI ETCD Pre-Load</a></li>
<li class="toctree-l3"><a class="reference internal" href="#azure-blob-storage">Azure Blob Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#azure-deployment-manifest">Azure Deployment Manifest</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#azure-iot-edge-simulator">Azure IoT Edge Simulator</a></li>
<li class="toctree-l2"><a class="reference internal" href="#supported-oei-services">Supported OEI Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="#additional-resources">Additional Resources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="opcua.html">OpcuaExport Application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="opcua.html#opcuaexport">OpcuaExport</a><ul>
<li class="toctree-l3"><a class="reference internal" href="opcua.html#configuration">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="opcua.html#service-bring-up">Service bring up</a></li>
<li class="toctree-l3"><a class="reference internal" href="opcua.html#opcua-client-apps">OPCUA client apps</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="restdata.html">RestDataExport service</a><ul>
<li class="toctree-l2"><a class="reference internal" href="restdata.html#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="restdata.html#http-get-api-of-rde">HTTP GET API of RDE</a><ul>
<li class="toctree-l3"><a class="reference internal" href="restdata.html#get-the-classifier-results-metadata">Get the classifier results metadata</a><ul>
<li class="toctree-l4"><a class="reference internal" href="restdata.html#request-to-get-metadata">Request to get metadata</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="restdata.html#get-images-using-the-image-handle">Get images using the image handle</a><ul>
<li class="toctree-l4"><a class="reference internal" href="restdata.html#request-to-get-images">Request to get images</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="restdata.html#prerequisites-for-running-restdataexport-to-post-on-http-servers">Prerequisites for running RestDataExport to POST on HTTP Servers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="restdata.html#launch-restdataexport-service">Launch RestDataExport service</a></li>
<li class="toctree-l2"><a class="reference internal" href="restdata.html#setting-environment-proxy-settings">Setting environment proxy settings</a></li>
</ul>
</li>
</ul>
<p><span class="caption-text">Additional Info:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tools.html">OEI Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tools.html#time-series-benchmarking-tool">Time Series Benchmarking Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#video-benchmarking-tool">Video Benchmarking Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#discoverhistory-tool">DiscoverHistory Tool</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tools.html#build-and-run-the-discoverhistory-tool">Build and run the DiscoverHistory tool</a><ul>
<li class="toctree-l4"><a class="reference internal" href="tools.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="tools.html#run-the-discoverhistory-tool-in-the-prod-mode">Run the DiscoverHistory tool in the PROD mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="tools.html#run-the-discoverhistory-tool-in-the-dev-mode">Run the DiscoverHistory tool in the DEV mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="tools.html#run-the-discoverhistory-tool-in-the-zmq-ipc-mode">Run the DiscoverHistory tool in the zmq_ipc mode</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#sample-select-queries">Sample select queries</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#multi-instance-feature-support-for-the-builder-script-with-the-discoverhistory-tool">Multi-instance feature support for the Builder script with the DiscoverHistory tool</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#embpublisher">EmbPublisher</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tools.html#how-to-integrate-this-tool-with-video-timeseries-use-case">How to integrate this tool with video/timeseries use case</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#configuration-of-the-tool">Configuration of the tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#running-embpublisher-in-ipc-mode">Running EmbPublisher in IPC mode</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#embsubscriber">EmbSubscriber</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tools.html#id25">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#running-embsubscriber">Running EmbSubscriber</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#running-embsubscriber-in-ipc-mode">Running EmbSubscriber in IPC mode</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#gigeconfig-tool">GigEConfig tool</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tools.html#generating-pfs-pylon-feature-stream-file">Generating PFS (Pylon Feature Stream) File</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#running-gigeconfig-tool">Running GigEConfig Tool</a><ul>
<li class="toctree-l4"><a class="reference internal" href="tools.html#usage-of-gigeconfig-tool">Usage of GigEConfig tool</a></li>
<li class="toctree-l4"><a class="reference internal" href="tools.html#execution-of-gigeconfig">Execution of GigEConfig</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#httptestserver">HttpTestServer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tools.html#prerequisites-for-running-the-httptestserver">Prerequisites for running the HttpTestServer</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#starting-httptestserver">Starting HttpTestServer</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#develop-python-user-defined-functions-using-jupyter-notebook">Develop Python User Defined Functions using Jupyter Notebook</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tools.html#prerequisites-for-using-jupyter-notebooks">Prerequisites for using Jupyter Notebooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#run-jupyter-notebook-from-web-browsers">Run Jupyter Notebook from web browsers</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#run-jupyter-notebook-using-visual-studio-code">Run Jupyter Notebook using Visual Studio Code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#mqtt-publisher">MQTT publisher</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tools.html#usage">Usage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#noderedhttpclientapp">NodeRedHttpClientApp</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tools.html#setting-up-nodered">Setting Up NodeRed</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#getting-oei-udf-classifier-results-data-to-node-red-environment-using-node-red-httpclient">Getting OEI UDF Classifier results data to Node-RED Environment Using Node-RED HTTPClient</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#sample-workflow">Sample Workflow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#software-trigger-utility-for-videoingestion-module">Software Trigger Utility for VideoIngestion Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tools.html#software-trigger-utilily-pre-requisites">Software Trigger Utilily pre-requisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#configuration-file">Configuration file</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#running-software-trigger-utility">Running Software Trigger Utility</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#usage-of-software-trigger-utility">Usage of Software Trigger Utility</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#oei-timeseriesprofiler">OEI TimeSeriesProfiler</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tools.html#id45">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#oei-timeseriesprofiler-modes">OEI TimeSeriesProfiler modes</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#oei-timeseriesprofiler-configurations">OEI TimeSeriesProfiler configurations</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#running-timeseriesprofiler">Running TimeSeriesProfiler</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tools.html#oei-video-profiler">OEI Video Profiler</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tools.html#oei-video-profiler-prerequisites">OEI Video Profiler prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#oei-video-profiler-modes">OEI Video Profiler modes</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#oei-video-profiler-configurations">OEI Video Profiler configurations</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#run-video-profiler">Run Video Profiler</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#running-videoprofiler-in-helm-usecase">Running VideoProfiler in helm usecase</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#optimizing-oei-video-pipeline-by-analysing-video-profiler-results">Optimizing OEI Video pipeline by analysing Video Profiler results</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#benchmarking-with-multi-instance-config">Benchmarking with multi-instance config</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sample.html">OEI Samples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="sample.html#sample-apps">Sample apps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="sample.html#run-the-samples-apps">Run the samples apps</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security</a><ul>
<li class="toctree-l2"><a class="reference internal" href="security.html#provisioning">Provisioning</a><ul>
<li class="toctree-l3"><a class="reference internal" href="security.html#generating-keys-and-certificates">Generating Keys and Certificates</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="security.html#start-up-and-run-time">Start Up and Run Time</a><ul>
<li class="toctree-l3"><a class="reference internal" href="security.html#accessing-secrets">Accessing Secrets</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="security.html#certificate-revocation">Certificate Revocation</a></li>
</ul>
</li>
</ul>


        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">OEI Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
  <!-- 3.0 -->
  
  

  <li><a href="../index.html">3.0</a> &raquo;</li>
  
  <li>Azure Bridge</li>

      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/pages/azure.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="azure-bridge">
<h1>Azure Bridge<a class="headerlink" href="#azure-bridge" title="Permalink to this headline">¶</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>In this document, you will find labels of ‘Edge Insights for Industrial (EII)’ for filenames, paths, code snippets, and so on. Consider the references of EII as Open Edge Insights (OEI). This is due to the product name change of EII as OEI.</p></li>
<li><p>For the various scripts and commands mentioned in this document to work, place the source code for this project in the <code class="docutils literal notranslate"><span class="pre">IEdgeInsights</span></code> directory in the source code for OEI.</p></li>
</ul>
</div>
<p>The Azure Bridge serves as a connector between OEI and the Microsoft Azure IoT Edge Runtime ecosystem. It does this by allowing the following forms of bridging:</p>
<ul class="simple">
<li><p>Publishing of incoming data from OEI onto the Azure IoT Edge Runtime bus</p></li>
<li><p>Storage of incoming images from the OEI video analytics pipeline into a local instance of the Azure Blob Storage service</p></li>
<li><p>Translation of configuration for OEI from the Azure IoT Hub digital twin for the bridge into ETCD via the OEI Configuration Manager APIs</p></li>
</ul>
<p>This code base is structured as an Azure IoT Edge Runtime module. It includes the following:</p>
<ul class="simple">
<li><p>Deployment templates for deploying the OEI video analytics pipeline with the bridge on top of the Azure IoT Edge Runtime</p></li>
<li><p>The Azure Bridge module</p></li>
<li><p>A simple subscriber on top of the Azure IoT Edge Runtime for showcasing the end-to-end transmission of data</p></li>
<li><p>Various utilities and helper scripts for deploying and developing on the Azure Bridge</p></li>
</ul>
<p>The following sections will cover the configuration/usage of the Azure Bridge, the deployment of OEI on the Azure IoT Edge Runtime, as well as the usage of the tools and scripts included in this code base for development.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following sections assume an understanding of the configuration
for OEI. It is recommended that you read the main README and User Guide for
OEI prior to using this service.</p>
</div>
</section>
<section id="prerequisites-and-setup">
<h2>Prerequisites and Setup<a class="headerlink" href="#prerequisites-and-setup" title="Permalink to this headline">¶</a></h2>
<p>To use and develop with the Azure Bridge there are a few steps which must be taken to configure your environment. The setup must be done to configure your Azure Cloud account, your development system, and also the node which you are going to deploy the Azure Bridge on.</p>
<p>The following sections cover the setup for the first two environments listed.
Setting up your system for a single-node deployment will be covered in the
<a class="reference external" href="#single-node-azure-iot-edge-deployment">Single-Node Azure IoT Edge Deployment</a> section below.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When you deploy with Azure IoT Hub you will also need to configure
the Azure IoT Edge Runtime and OEI on your target device.</p>
</div>
<section id="azure-cloud-setup">
<h3>Azure Cloud Setup<a class="headerlink" href="#azure-cloud-setup" title="Permalink to this headline">¶</a></h3>
<p>Prior to using the Azure Bridge there are a few cloud services in Azure
which must be initialized.</p>
<p>Primarily, you need an Azure Containter Registry instance, an Azure IoT Hub,
as well as an Azure IoT Device. Additionally, if you wish to use the sample ONNX
UDF in OEI to download a ML/DL model from AzureML, then you must follow a few
steps to get this configured as well. For these steps, see the <a class="reference external" href="#setting-up-azureml">Setting up AzureML</a>
section below.</p>
<p>To create these instances, follow the guides provided by Microsoft below:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the quickstart guides below it is recommended that you create an
Azure Resource Group. This is a good practice as it makes for easy clean up
of your Azure cloud environment.</p>
</div>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.microsoft.com/en-us/azure/container-registry/container-registry-get-started-portal">Create Azure Container Registry</a></p></li>
<li><p><a class="reference external" href="https://docs.microsoft.com/en-us/azure/iot-hub/iot-hub-create-through-portal">Create Azure IoT Hub</a></p></li>
<li><p><a class="reference external" href="https://docs.microsoft.com/en-us/azure/iot-edge/how-to-register-device">Register an Azure IoT Device</a></p></li>
</ul>
<blockquote>
<div><p><strong>IMPORTANT:</strong>
In the tutorials above you will receive credentials/connection strings for your
Azure Container Registry, Azure IoT Hub, and Azure IoT Device. Save these for
later, as they will be important for setting up your development and single node
deployment showcased in this README.</p>
</div></blockquote>
<p>All of the tutorials provided above provide options for creating these instances
via Visual Studio Code, the Azure Portal, or the Azure CLI. If you wish to use
the Azure CLI, it is recommended that you follow the Development System Setup
instructions below.</p>
<section id="setting-up-azureml">
<h4>Setting up AzureML<a class="headerlink" href="#setting-up-azureml" title="Permalink to this headline">¶</a></h4>
<p>To use the sample OEI ONNX UDF, you must do the following:</p>
<ol class="arabic simple">
<li><dl class="simple">
<dt>Create an AzureML Workspace (see <a class="reference external" href="https://docs.microsoft.com/en-us/azure/machine-learning/how-to-manage-workspace">these</a></dt><dd><p>instructions provided by Microsoft)</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Configure Service Principle Authentication on your AzureML workspace by following</dt><dd><p>instructions provided <a class="reference external" href="https://docs.microsoft.com/en-us/azure/machine-learning/how-to-setup-authentication#set-up-service-principal-authentication">here</a></p>
</dd>
</dl>
</li>
</ol>
</section>
<section id="important">
<h4>Important<a class="headerlink" href="#important" title="Permalink to this headline">¶</a></h4>
<p>During the setup process provided for step 2 above, you will run a command similar
to the following:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>az ad sp create-for-rbac --sdk-auth --name ml-auth
</pre></div>
</div>
<p>After executing this command you will see a JSON blob printed to your console
window. Save the <code class="docutils literal notranslate"><span class="pre">clientId</span></code>, <code class="docutils literal notranslate"><span class="pre">clientSecret</span></code>, <code class="docutils literal notranslate"><span class="pre">subscriptionId</span></code>, and <code class="docutils literal notranslate"><span class="pre">tenantId</span></code>
for configuring the sample ONNX OEI UDF later.</p>
<section id="pushing-a-model-to-azureml">
<h5>Pushing a Model to AzureML<a class="headerlink" href="#pushing-a-model-to-azureml" title="Permalink to this headline">¶</a></h5>
<p>If you already have an ONNX model you wish to push to your AzureML Workspace, then
follow <a class="reference external" href="https://docs.microsoft.com/en-us/azure/machine-learning/how-to-deploy-existing-model">these instructions</a>
to push your model.</p>
<p>If you do not have a model, and want an easy model to use, follow
<a class="reference external" href="https://notebooks.azure.com/azureml/projects/azureml-getting-started/html/how-to-use-azureml/deployment/onnx/onnx-modelzoo-aml-deploy-resnet50.ipynb">this</a>
notebook provided my Microsoft to train a simple model to push to your AzureML Workspace.</p>
<p>Also, you can find pre-trained models in the <a class="reference external" href="https://github.com/onnx/models">ONNX Model Zoo</a>.</p>
</section>
</section>
</section>
<section id="development-system-setup">
<h3>Development System Setup<a class="headerlink" href="#development-system-setup" title="Permalink to this headline">¶</a></h3>
<p>The development system will be used for the following actions:</p>
<ul class="simple">
<li><p>Building and pushing the OEI containers (including the bridge) to your Azure Container Registry</p></li>
<li><p>Creating your Azure IoT Hub deployment manifest</p></li>
<li><p>Deploying your manifest to a single node</p></li>
</ul>
<p>For testing purposes, your development system can serve to do the actions detailed
above, as well as being the device you use for your single-node deployment. This
should not be done in a production environment, but it can be helpful when
familiarizing yourself with the Azure Bridge.</p>
<p>First, setup your system for building OEI. To do this, follow the instructions
detailed in the main OEI README and the OEI User Guide. At the end, you should
have installed Docker, Docker Compose, and other OEI Python dependencies for
the Builder script in the <code class="docutils literal notranslate"><span class="pre">../build/</span></code> directory.</p>
<p>Once this is completed, install the required components to user the Azure CLI
and development tools. The script <code class="docutils literal notranslate"><span class="pre">./tools/install-dev-tools.sh</span></code> automates this
process. To run this script, execute the following command:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>It is highly recommended that you use a python virtual environment to install the python packages, so that the system python installation doesn’t get altered. Details on setting up and using python virtual environment can be found here: <a class="reference external" href="https://www.geeksforgeeks.org/python-virtual-environment/">https://www.geeksforgeeks.org/python-virtual-environment/</a></p></li>
<li><p>If one encounter issues with conflicting dependencies between python packages, please upgrade the pip version: <code class="docutils literal notranslate"><span class="pre">pip3</span> <span class="pre">install</span> <span class="pre">-U</span> <span class="pre">pip</span></code> and try.</p></li>
</ul>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo -H -E -u <span class="si">${</span><span class="nv">USER</span><span class="si">}</span> ./tools/install-dev-tools.sh
</pre></div>
</div>
<p>Please set the <code class="docutils literal notranslate"><span class="pre">PATH</span></code> environmental variable as below in the terminal
where you are using <code class="docutils literal notranslate"><span class="pre">iotedgedev</span></code> and <code class="docutils literal notranslate"><span class="pre">iotedgehubdev</span></code> commands:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span>~/.local/bin:<span class="nv">$PATH</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">-u</span> <span class="pre">${USER}</span></code> flag above allows the Azure CLI to launch your browser (if it can) so you can login to your Azure account.</p></li>
<li><p>Occasionally, pip’s local cache can get corrupted. If this happens,
pip may <code class="docutils literal notranslate"><span class="pre">SEGFAULT</span></code>. In the case that this happens, delete the <code class="docutils literal notranslate"><span class="pre">~/.local</span></code> directory
on your system and re-run the script mentioned above. You may consider creating
a backup of this directory just in case.</p></li>
</ul>
</div>
<p>While running this script you will be prompted to sign-in to your Azure
account so you can run commands from the Azure CLI that interact with your
Azure instance.</p>
<p>This script will install the following tools:</p>
<ul class="simple">
<li><p>Azure CLI</p></li>
<li><p>Azure CLI IoT Edge/Hub Extensions</p></li>
<li><p>Azure <code class="docutils literal notranslate"><span class="pre">iotedgehubdev</span></code> development tool</p></li>
<li><p>Azure <code class="docutils literal notranslate"><span class="pre">iotedgedev</span></code> development tool</p></li>
</ul>
<p>Next, login to your Azure Container Registry with the following command:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>az acr login --name &lt;ACR Name&gt;
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Fill in <code class="docutils literal notranslate"><span class="pre">&lt;ACR</span> <span class="pre">Name&gt;</span></code> with the name of your Azure Container Registry</p>
</div>
<p><strong>IMPORTANT NOTE:</strong></p>
<p>Please see the list of supported services at the end of this README for the
services which can be pushed to an ACR instance. Not all OEI services are
supported by and validated to work with the Azure Bridge.</p>
</section>
</section>
<section id="build-and-push-oei-containers">
<h2>Build and Push OEI Containers<a class="headerlink" href="#build-and-push-oei-containers" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By following the steps below, the Azure Bridge and Simple
Subscriber Azure IoT Modules will be pushed to your ACR instance as well.</p>
</div>
<p>After setting up your development system, build and push the OEI containers
to your Azure Contianer Registry instance. Note that the Azure Bridge only
supports a few of the OEI services currently. Before building and pushing your
OEI containers, be sure to look at the <a class="reference external" href="#supported-oei-services">Supported OEI Services</a>
section below, so as to not build/push uneeded containers to your registry.</p>
<p>To do this go to the <code class="docutils literal notranslate"><span class="pre">../build/</span></code> directory in the OEI source code, modify the
<code class="docutils literal notranslate"><span class="pre">DOCKER_REGISTRY</span></code> variable in the <code class="docutils literal notranslate"><span class="pre">../build/.env</span></code> file to point to your Azure
Container Registry.</p>
<p>Next, execute the following commands:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python3 builder.py -f usecases/video-streaming-azure.yml
docker-compose -f docker-compose-build.yml build
docker-compose -f docker-compose-push.yml push
</pre></div>
</div>
<p>For more detailed instructions on this process, see the OEI README and User Guide.</p>
</section>
<section id="single-node-azure-iot-edge-deployment">
<h2>Single-Node Azure IoT Edge Deployment<a class="headerlink" href="#single-node-azure-iot-edge-deployment" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Outside of the Azure ecosystem, OEI can be deployed and communicate
across nodes. In the Azure IoT Edge ecosystem this is not possible with OEI.
All OEI services must be running on the same edge node. However, you can
deploy OEI on multiple nodes, but intercommunication between the nodes will
not work.
<strong>Important Note:</strong>
If you are using TCP communication between VI or VA and the Azure Bridge,
then you must modify the <code class="docutils literal notranslate"><span class="pre">AllowedClients</span></code> list under the <code class="docutils literal notranslate"><span class="pre">Publishers</span></code> section
of the interfaces configuration of VI or VA to include <code class="docutils literal notranslate"><span class="pre">AzureBridge</span></code>.
This must be done prior to provisioning to that the proper certificates will
be generated to encrypt/authenticate connections.</p>
</div>
<p>In the Azure IoT ecosystem you can deploy to single-nodes and you can do bulk
deployments. This section will cover how to deploy the Azure Bridge and
associated OEI services to a single Linux edge node. For more details on deploying
modules at scale with the Azure IoT Edge Runtime, see
<a class="reference external" href="https://docs.microsoft.com/en-us/azure/iot-edge/how-to-deploy-monitor">this guide</a></p>
<p>Note that this section will give a high-level overview of how to deploy the
modules with the Azure CLI. For more information on developing and deploying
Azure modules, see <a class="reference external" href="https://docs.microsoft.com/en-us/azure/iot-edge/tutorial-develop-for-linux">this guide</a>.</p>
<p>The deloyment of the Azure IoT Edge and the OEI modules can be broken down into
the following steps:</p>
<ol class="arabic simple">
<li><p>Provisioning</p></li>
<li><p>Configuring OEI</p></li>
<li><p>Configuring Azure IoT Deployment Manifest</p></li>
<li><p>Deployment</p></li>
</ol>
<p>Prior to deploying a single Azure IoT Edge node you must have already
configured your Azure cloud instance (see instructions in the <a class="reference external" href="#azure-cloud-setup">Azure Cloud Setup</a>
section). Additionally, you need to have already built and pushed the OEI services to your
Azure Container Registry (follow the instructions in the <a class="reference external" href="#build-and-push-eii-containers">Build and Push OEI Containers</a>
section).</p>
<p>Provided you have met these two prerequisites, follow the steps below to do a
single node deployment with the Azure Bridge on the Azure IoT Edge Runtime.</p>
<section id="step-1-provisioning">
<h3>Step 1 - Provisioning<a class="headerlink" href="#step-1-provisioning" title="Permalink to this headline">¶</a></h3>
<p>The provisioning must take place on the node you wish to deploy your Azure IoT
Edge modules onto.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This may be your development system, which was setup earlier. Keep in
mind, however, that having your system setup as a development system and a
targeted node for a single-node deployment should never be done in production.</p>
</div>
<p>First, you must then install the Azure IoT Edge Runtime on your target deployment
system. To do that, follow the instructions provided by Microsoft in
<a class="reference external" href="https://docs.microsoft.com/en-us/azure/iot-edge/how-to-install-iot-edge-linux">this guide</a>.</p>
<p>Next, you must provision on your target deployment system. This provisioning is supported
by the configmanager agent azure module itself.</p>
<p>While provisioning on your system, note that you only need to setup the
Video Ingesiton and/or the Video Analytics containers. All other services are
not supported by the Azure Bridge currently.</p>
<p>Be sure to note down which directory you generate your certificates into, this
will be important later. Unless, you are running OEI in dev mode, in that case
you will have no certificates generated.</p>
<p><strong>IMPORTANT NOTE:</strong></p>
<p>If you previously installed OEI outside of Azure on your system, then make sure
that all of the OEI containers have been stopped. You can do this by going to
the <code class="docutils literal notranslate"><span class="pre">build/</span></code> directory in the OEI source code and running the following command:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>docker-compose down
</pre></div>
</div>
<p>This will stop and remove all of the previously running OEI containers, allowing
the Azure Bridge to run successfully.</p>
</section>
<section id="step-2-configuring-oei">
<h3>Step 2 - Configuring OEI<a class="headerlink" href="#step-2-configuring-oei" title="Permalink to this headline">¶</a></h3>
<p>This step should be done from your development system, and not the edge node you
are deploying OEI onto. The configuration you will do during this setup will
allow your system to deploy OEI to your edge node. As noted earlier, for development
and testing purposes this could be the same system as your targeted edge device,
but this is not recommended in a production environment.</p>
<p>To configure OEI, modify the <code class="docutils literal notranslate"><span class="pre">build/eii_config.json</span></code> file. This
should have been generated when the <code class="docutils literal notranslate"><span class="pre">build/builder.py</span></code> script was executed
when building/pushing the OEI containers to your ACR instance. If it does not
exist, run this script based on the instructions provided in the OEI README.</p>
<p>Next, configure the <code class="docutils literal notranslate"><span class="pre">build/.env</span></code> file. You must make sure to modify the following
values in the <code class="docutils literal notranslate"><span class="pre">.env</span></code> file:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">DOCKER_REGISTRY</span></code> - This should have been set when building/pushing the OEI</dt><dd><p>containers to your ACR instance. Make sure it is set to the URL for your
ACR instance.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">HOST_IP</span></code> - This must be the IP address of the edge node you are deploying</dt><dd><p>your containers to</p>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ETCD_HOST</span></code> - This should be set to the same value as your <code class="docutils literal notranslate"><span class="pre">HOST_IP</span></code> address</p></li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">DEV_MODE</span></code> - Set this to the same value you used when provisioning your edge node</dt><dd><p>in the previous step</p>
</dd>
</dl>
</li>
</ul>
<p>Next, in the <code class="docutils literal notranslate"><span class="pre">AzureBridge/</span></code> source directory, modify the <code class="docutils literal notranslate"><span class="pre">.env</span></code> file. Make
sure to set the following values:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">EII_CERTIFICATES</span></code>              - The directory with the OEI certificates on your edge system</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AZ_CONTAINER_REGISTY_USERNAME</span></code> - User name for the container registry login (obtained during creation)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AZ_CONTAINER_REGISTY_PASSWORD</span></code> - Password for the container registry login (obtained during creation)</p>
<ul>
<li><p><strong>IMPORTANT NOTE:</strong> Make sure to surround the password in single quotes, i.e. <code class="docutils literal notranslate"><span class="pre">'</span></code>, because bash
.. code-block:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">may</span> <span class="n">escape</span> <span class="n">certain</span> <span class="n">characters</span> <span class="n">when</span> <span class="n">the</span> <span class="n">file</span> <span class="ow">is</span> <span class="n">read</span><span class="p">,</span> <span class="n">leading</span> <span class="n">to</span> <span class="n">incorrect</span> <span class="n">configuration</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">AZ_BLOB_STORAGE_ACCOUNT_NAME</span></code>  - <strong>(OPTIONAL)</strong> User name for the local Azure Blob Storage instance</p></li>
</ul>
<p><strong>IMPORTANT NOTE #1:</strong></p>
<p>It is important to note that for the <code class="docutils literal notranslate"><span class="pre">AZ_CONTAINER_REGISTY_PASSWORD</span></code> variable you
must wrap the password in single quotes, i.e. <code class="docutils literal notranslate"><span class="pre">'</span></code>. Otherwise, there may be
characters that get escaped in a weird way when the values are populated into
your deployment manifest leading to configuration errors.</p>
<p><strong>IMPORTANT NOTE #2:</strong></p>
<p>If you wish to use the sample OEI ONNX UDF, now is the time to configure the UDF
to run. See the <a class="reference external" href="#sample-oei-onnx-udf">Sample OEI ONNX UDF</a> configuration section
below for how to configure the UDF.</p>
<p>Once the following step has been completed, then you should have correctly configured
<code class="docutils literal notranslate"><span class="pre">.env</span></code> files to deploying OEI via Azure. If some of the values were incorrect, then
you will encounter issues in the proceeding steps.</p>
</section>
<section id="step-3-configuring-azure-iot-deployment-manifest">
<h3>Step 3 - Configuring Azure IoT Deployment Manifest<a class="headerlink" href="#step-3-configuring-azure-iot-deployment-manifest" title="Permalink to this headline">¶</a></h3>
<p>Once you have your target edge system provisioned and OEI configured, you need to
create your Azure IoT Hub deployment manifest. The Azure Bridge provides some
convenience scripts to ease this process.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These steps should be done from your development system setup in
the <a class="reference external" href="#development-system-setup">Development System Setup</a> section. Note, that for testing
and development purposes, these could be the same system.</p>
</div>
<p>To generate your deployment manifest template, execute the following command:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>./tools/generate-deployment-manifest.sh example ia_configmgr_agent AzureBridge SimpleSubscriber ia_video_ingestion ia_video_analytics
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>If you are using Azure Blob Storage, include <code class="docutils literal notranslate"><span class="pre">AzureBlobStorageonIoTEdge</span></code> in the argument list above.</p></li>
<li><p>When you run the command above, it will pull some values from your OEI <code class="docutils literal notranslate"><span class="pre">build/.env</span></code> file. If the <code class="docutils literal notranslate"><span class="pre">build/.env</span></code> file is configured incorrectly, you may run into issues.</p></li>
</ul>
</div>
<p>The above command will generate two files: <code class="docutils literal notranslate"><span class="pre">./example.template.json</span></code> and <code class="docutils literal notranslate"><span class="pre">config/example.amd64.json</span></code>. The first is a deployment template, and the second is the fully populated/generated configuration for Azure IoT Hub. In executing the script above, you should have a manifest which includes the Azure Bridge, Simple Subscriber, as well as the OEI video ingestion service.</p>
<p>The list of services given to the bash script can be changed if you wish to run different services.</p>
<p>You may want/need to modify your <code class="docutils literal notranslate"><span class="pre">./example.template.json</span></code> file after running
this command. This could be because you wish to change the topics that VI/VA use
or because you want to configure the Azure Bridge in some different way. If you
modify this file, you must regenerate the <code class="docutils literal notranslate"><span class="pre">./config/example.amd64.json</span></code> file.
To do this, execute the following command:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>iotedgedev genconfig -f example.template.json
</pre></div>
</div>
<p>If you wish to modify your <code class="docutils literal notranslate"><span class="pre">eii_config.json</span></code> file after generating your template,
you can re-add this to the Azure Bridge digital twin by running the following
command:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python3 tools/serialize_eii_config.py example.template.json ../build/eii_config.json
</pre></div>
</div>
<p>If all of the commands above ran correctly, then you will have a valid <code class="docutils literal notranslate"><span class="pre">*.template.json</span></code> file and a valid <code class="docutils literal notranslate"><span class="pre">config/*.amd64.json</span></code> file.</p>
<p>If, for some reason, these commands fail, revisit Step 2 and make sure all of your
environmental variables are set correctly. And if that does not resolve your issue,
verify that your development system is setup correctly by revisiting the
<a class="reference external" href="#development-system-setup">Development System Setup</a> section.</p>
</section>
<section id="step-4-deployment">
<h3>Step 4 - Deployment<a class="headerlink" href="#step-4-deployment" title="Permalink to this headline">¶</a></h3>
<p>Now that you have generated your deployment manifest, deploy the modules to your
Azure IoT Edge Device using the Azure CLI command shown below:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>az iot edge set-modules -n &lt;azure-iot-hub-name&gt; -d &lt;azure-iot-edge-device-name&gt; -k config/&lt;deployment-manifest&gt;
</pre></div>
</div>
<p>If this command run successfully, then you will see a large JSON string print out
on the console with information on the deployment which it just initiated. If it
failed, then the Azure CLI will output information on the potential reason for the
failure.</p>
<p>Provided all of the setups above ran correctly, your edge node should now be running
your Azure IoT Edge modules, the Azure Bridge, and the OEI services you
selected.</p>
<p>It is possible that for the Azure Bridge (and any Python Azure IoT Edge modules)
you will see that the service crashes the first couple of times it attempts to come
up on your edge system with an exception similar to the following:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
    File <span class="s2">&quot;/usr/local/lib/python3.7/site-packages/azure/iot/device/common/mqtt_transport.py&quot;</span>, line <span class="m">340</span>, <span class="k">in</span> connect
        <span class="nv">host</span><span class="o">=</span>self._hostname, <span class="nv">port</span><span class="o">=</span><span class="m">8883</span>, <span class="nv">keepalive</span><span class="o">=</span>DEFAULT_KEEPALIVE
    File <span class="s2">&quot;/usr/local/lib/python3.7/site-packages/paho/mqtt/client.py&quot;</span>, line <span class="m">937</span>, <span class="k">in</span> connect
        <span class="k">return</span> self.reconnect<span class="o">()</span>
    File <span class="s2">&quot;/usr/local/lib/python3.7/site-packages/paho/mqtt/client.py&quot;</span>, line <span class="m">1071</span>, <span class="k">in</span> reconnect
        <span class="nv">sock</span> <span class="o">=</span> self._create_socket_connection<span class="o">()</span>
    File <span class="s2">&quot;/usr/local/lib/python3.7/site-packages/paho/mqtt/client.py&quot;</span>, line <span class="m">3522</span>, <span class="k">in</span> _create_socket_connection
        <span class="k">return</span> socket.create_connection<span class="o">(</span>addr, <span class="nv">source_address</span><span class="o">=</span>source, <span class="nv">timeout</span><span class="o">=</span>self._keepalive<span class="o">)</span>
    File <span class="s2">&quot;/usr/local/lib/python3.7/socket.py&quot;</span>, line <span class="m">728</span>, <span class="k">in</span> create_connection
        raise err
    File <span class="s2">&quot;/usr/local/lib/python3.7/socket.py&quot;</span>, line <span class="m">716</span>, <span class="k">in</span> create_connection
        sock.connect<span class="o">(</span>sa<span class="o">)</span>
    ConnectionRefusedError: <span class="o">[</span>Errno <span class="m">111</span><span class="o">]</span> Connection refused
</pre></div>
</div>
<p>This occurs because the container is starting before the <code class="docutils literal notranslate"><span class="pre">edgeHub</span></code> container for
the Azure IoT Edge Runtime has come up, and so it it unable to connect. Once the
<code class="docutils literal notranslate"><span class="pre">edgeHub</span></code> container is fully launched, then this should go away and the containers
should launch correctly.</p>
<p>If everything is running smoothly, you should see messages being printed in the
Simple Subscriber service using the following command:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>docker logs -f SimpleSubscriber
</pre></div>
</div>
<p>For more debugging info, see the following section.</p>
</section>
<section id="helpful-debugging-commands">
<h3>Helpful Debugging Commands<a class="headerlink" href="#helpful-debugging-commands" title="Permalink to this headline">¶</a></h3>
<p>If you are encountering issues, the following commands can help with debugging:</p>
<ul class="simple">
<li><p><strong>Azure IoT Edge Runtime Daemon Logs:</strong> <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">iotedge</span> <span class="pre">system</span> <span class="pre">logs</span> <span class="pre">--</span> <span class="pre">-f</span></code></p></li>
<li><p><strong>Container Logs:</strong> <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">logs</span> <span class="pre">-f</span> <span class="pre">&lt;CONTAINER-NAME&gt;</span></code></p></li>
</ul>
</section>
<section id="final-notes">
<h3>Final Notes<a class="headerlink" href="#final-notes" title="Permalink to this headline">¶</a></h3>
<p>When deploying with Azure IoT Edge Runtime there are many security considerations
to be taken into account. Please consult the following Microsoft resources regarding
the security in your deployments.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.microsoft.com/en-us/azure/iot-edge/security">Securing Azure IoT Edge</a></p></li>
<li><p><a class="reference external" href="https://docs.microsoft.com/en-us/azure/iot-edge/iot-edge-security-manager">IoT Edge Security Manager</a></p></li>
<li><p><a class="reference external" href="https://docs.microsoft.com/en-us/azure/iot-edge/iot-edge-certs">IoT Edge Certificates</a></p></li>
<li><p><a class="reference external" href="https://azure.microsoft.com/en-us/blog/securing-the-intelligent-edge/">Securing the Intelligent Edge blob post</a></p></li>
</ul>
</section>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>The configuration of the Azure Bridge is a mix of the configuration for the
OEI services, the Azure Bridge module, and configuration for the other
Azure IoT Edge Modules (i.e. the Simple Subscriber, and the Azure Blob Storage
modules). All of this configuration is wrapped up into your deployment manifest
for Azure IoT Hub.</p>
<p>The following sections cover the configuration of the aforementioned servies
and then the generation of your Azure Deployment manifest.</p>
<section id="id3">
<h3>Azure Bridge<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>The Azure Bridge spans OEI and Azure IoT Edge Runtime environments, as such
its configuration is a mix of OEI configuration and Azure IoT Edge module configuration
properties. The configuration of the bridge is split between environmental
variables specified in your Azure IoT Hub deployment manifest and the module’s
digital twin. Additionally, the digital twin for the Azure Bridge module
contains the entire configuration for the OEI services running in your edge
environment.</p>
<p>The configuration of the OEI Message Bus is done in a method similar to that of
the other OEI services, such as the Video Analytics service. To provided the
configuration for the topics which the bridge should subscribe to,
you must set the <code class="docutils literal notranslate"><span class="pre">Subscribers</span></code> list in the <a class="reference external" href="https://github.com/open-edge-insights/eii-azure-bridge/blob/master/modules/AzureBridge/config.json">modules/AzureBridge/config.json</a>
file. The list is comprised of JSON objects for every subscription you wish the
Azure Bridge to establish. Below is an example of the configuration for
subscribing to the the publications coming from the Video Analytics container.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;Subscribers&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="c1">// Specifies that this is the default subscriber</span>
            <span class="s2">&quot;Name&quot;</span><span class="o">:</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>

            <span class="c1">// Gives the type of connection, i.e. zmq_tcp, this could</span>
            <span class="c1">// also be zmq_ipc</span>
            <span class="s2">&quot;Type&quot;</span><span class="o">:</span> <span class="s2">&quot;zmq_tcp&quot;</span><span class="p">,</span>

            <span class="c1">// The EndPoint specifies the details of the connect, for an</span>
            <span class="c1">// IPC connection, this would be a JSON object with the</span>
            <span class="c1">// SocketDir key pointing to the directory of the IPC sockets</span>
            <span class="s2">&quot;EndPoint&quot;</span><span class="o">:</span> <span class="s2">&quot;127.0.0.1:65013&quot;</span><span class="p">,</span>

            <span class="c1">// Specification of the AppName of the service publishing the</span>
            <span class="c1">// messages. This allows the Azure Bridge to get the needed</span>
            <span class="c1">// authentication keys to subscribe</span>
            <span class="s2">&quot;PublisherAppName&quot;</span><span class="o">:</span> <span class="s2">&quot;VideoAnalytics&quot;</span><span class="p">,</span>

            <span class="c1">// Specifies the list of all of the topics which the</span>
            <span class="c1">// AzureBridge shall subscribe to</span>
            <span class="s2">&quot;Topics&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="s2">&quot;camera1_stream_results&quot;</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>There are a few important implications to be aware of for both ZeroMQ TCP and IPC
subscribers over the OEI Message Bus. These implications are specified below.</p>
</section>
<section id="zeromq-tcp-subscription-implications">
<h3>ZeroMQ TCP Subscription Implications<a class="headerlink" href="#zeromq-tcp-subscription-implications" title="Permalink to this headline">¶</a></h3>
<p>For ZeroMQ TCP subscribers, like the example shown above, the <code class="docutils literal notranslate"><span class="pre">EndPoint</span></code> in
the subscriber’s configuration object has to be overridden through an
environmental variable. The reason for this, is that the Azure Bridge
service runs attached to a bridged Docker network created by the Azure IoT
Edge Runtime, whereas the other OEI services run on the different bridged network.
In order to subscribe, the Azure Bridge must use the host’s IP address to
connect.</p>
<p>If the Azure Bridge is only subscribing to a single service, then the
<code class="docutils literal notranslate"><span class="pre">EndPoint</span></code> can be overridden by setting the <code class="docutils literal notranslate"><span class="pre">SUBSCRIBER_ENDPOINT</span></code> environmental
variable. The environmental variable changes if there are multiple subscribers.
For instance, if the configuration example had another object in the Subscribers
list which had the <code class="docutils literal notranslate"><span class="pre">Name</span></code> key set to <code class="docutils literal notranslate"><span class="pre">example_name</span></code>, then the environmental
variable name would need to be <code class="docutils literal notranslate"><span class="pre">SUBSCRIBER_example_name_ENDPOINT</span></code>. Essentially,
for multiple subscribers the <code class="docutils literal notranslate"><span class="pre">Name</span></code> property must be in the environmental
variable name between the <code class="docutils literal notranslate"><span class="pre">SUBSCRIBER_</span></code> and <code class="docutils literal notranslate"><span class="pre">_ENDPOINT</span></code>. The same holds true for
<code class="docutils literal notranslate"><span class="pre">CLIENT_ENDPOINT</span></code> and <code class="docutils literal notranslate"><span class="pre">CLIENT_&lt;Name&gt;_ENDPOINT</span></code> usage of environmental variables too.</p>
<p>In either case, the value of the environmental variable must be set to
<code class="docutils literal notranslate"><span class="pre">$HOST_IP:&lt;PORT&gt;</span></code> where you must fill in what the desired port is. Note that the
IP address is the variable <code class="docutils literal notranslate"><span class="pre">$HOST_IP</span></code>. This will be pulled from the <code class="docutils literal notranslate"><span class="pre">.env</span></code> file
when generating your deployment manifest.</p>
<p>The final implication is on the configuration of the services which the
Azure Bridge is subscribing to. Most OEI services publishing over TCP set
their host to <code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code>. This keeps the communication only available to
subscribers which are on the local host network on the system. In order for
the Azure Bridge to subscribe to these publications this must be changed
to <code class="docutils literal notranslate"><span class="pre">0.0.0.0</span></code>.</p>
<p>This can be accomplished by overridding the service’s publisher <code class="docutils literal notranslate"><span class="pre">EndPoint</span></code>
configuration via environmental variables, just like with the Azure Bridge
service. For each service which the Azure Bridge needs to subscribe to over
TCP, add the environmental variable <code class="docutils literal notranslate"><span class="pre">PUBLISHER_ENDPOINT=0.0.0.0:&lt;PORT&gt;</span></code> to the
environmental variable configuration of the serivce’s module configuration in
your deployment manifest (note: be sure to replace the port).  Or if there are
multiple topics being published, use the variable <code class="docutils literal notranslate"><span class="pre">PUBLISHER_&lt;Name&gt;_ENDPOINT</span></code>.
The same holds true for <code class="docutils literal notranslate"><span class="pre">SERVER_ENDPOINT</span></code> and <code class="docutils literal notranslate"><span class="pre">SERVER_&lt;Name&gt;_ENDPOINT</span></code> usage
of environmental variables too.</p>
<p>These variables have already been set for to have the Azure Bridge subscribe
to a single instance of the Video Analytics service. This configuration can be
seen in your deployment manifest under the, “AzureBridge”, and, “ia_video_analytics”,
modules. Or, you can see this configuration being set in the,
“config/templates/ia_video_analytics.template.json”, and,
“config/templates/AzureBridge.template.json”, files.</p>
</section>
<section id="zeromq-ipc-subscription-implications">
<h3>ZeroMQ IPC Subscription Implications<a class="headerlink" href="#zeromq-ipc-subscription-implications" title="Permalink to this headline">¶</a></h3>
<p>If AzureBridge is subscribing to publisher over a ZeroMQ IPC socket, ensure the following:</p>
<ul>
<li><p>AzureBridge app’s subscriber interfaces configuration matches to that of the publisher app’s publisher interfaces configuration in <code class="docutils literal notranslate"><span class="pre">build/eii_config.json</span></code> file.  The following is an example of the AzureBridge interface configuration subscribing to the publications coming from the VideoIngestion container.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;Subscribers&quot;</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
          <span class="c1">// Specifies that this is the default subscriber</span>
          <span class="s2">&quot;Name&quot;</span><span class="o">:</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>

          <span class="c1">// Gives the type of connection, i.e. zmq_tcp/zmq_ipc</span>
          <span class="s2">&quot;Type&quot;</span><span class="o">:</span> <span class="s2">&quot;zmq_ipc&quot;</span><span class="p">,</span>

          <span class="c1">// The EndPoint specifies the details of the connect, for an</span>
          <span class="c1">// IPC connection, this would be a JSON object with the</span>
          <span class="c1">// SocketDir key pointing to the directory of the IPC sockets</span>
          <span class="s2">&quot;EndPoint&quot;</span><span class="o">:</span> <span class="s2">&quot;/EII/sockets&quot;</span><span class="p">,</span>

          <span class="c1">// Specification of the AppName of the service publishing the</span>
          <span class="c1">// messages. This allows the Azure Bridge to get the needed</span>
          <span class="c1">// authentication keys to subscriber</span>
          <span class="s2">&quot;PublisherAppName&quot;</span><span class="o">:</span> <span class="s2">&quot;VideoIngestion&quot;</span><span class="p">,</span>

          <span class="c1">// Specifies the list of all of the topics which the</span>
          <span class="c1">// AzureBridge shall subscribe to</span>
          <span class="s2">&quot;Topics&quot;</span><span class="o">:</span> <span class="p">[</span>
              <span class="s2">&quot;camera1_stream&quot;</span>
          <span class="p">]</span>
      <span class="p">}</span>
   <span class="p">]</span>
  <span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Follow <code class="docutils literal notranslate"><span class="pre">Step</span> <span class="pre">3</span> <span class="pre">-</span> <span class="pre">Configuring</span> <span class="pre">Azure</span> <span class="pre">IoT</span> <span class="pre">Deployment</span> <span class="pre">Manifest</span></code> to generate the manifest template file and deployment manifest files. Ensure to remove all the <code class="docutils literal notranslate"><span class="pre">PUBLISHER_ENDPOINT</span></code> <code class="docutils literal notranslate"><span class="pre">PUBLISHER_&lt;Name&gt;_ENDPOINT</span></code>, <code class="docutils literal notranslate"><span class="pre">SUBSCRIBER_ENDPOINT</span></code>, and <code class="docutils literal notranslate"><span class="pre">SUBSCRIBER_&lt;Name&gt;_ENDPOINT</span></code> environmental variables from the generated deployment manifest template file i.e., <a class="reference external" href="https://github.com/open-edge-insights/eii-azure-bridge/blob/master/example.template.json">example.template.json</a> as these ENVs are not applicable for IPC configuration. Additionally, update the <a class="reference external" href="https://github.com/open-edge-insights/eii-azure-bridge/blob/master/example.template.json">example.template.json</a> as per the recommendations mentioned in the <code class="docutils literal notranslate"><span class="pre">Important</span> <span class="pre">Note</span></code> section for IPC configuration. Run the following command to regenerate the deployment manifest file (<code class="docutils literal notranslate"><span class="pre">config/example.amd64.json</span></code>):</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>iotedgedev genconfig -f example.template.json
</pre></div>
</div>
</li>
<li><p>Follow  <a class="reference external" href="#step-4-deployment">Step 4 - Deployment</a> for deployment. The following is an example of digital twin for the Azure Bridge:</p></li>
</ul>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;log_level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;topics&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;camera1_stream_results&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;az_output_topic&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;camera1_stream_results&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;eii_config&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{\&quot;/AzureBridge/config\&quot;: {}, \&quot;/AzureBridge/interfaces\&quot;: {\&quot;Subscribers\&quot;: [{\&quot;EndPoint\&quot;: \&quot;127.0.0.1:65013\&quot;, \&quot;Name\&quot;: \&quot;default\&quot;, \&quot;PublisherAppName\&quot;: \&quot;VideoAnalytics\&quot;, \&quot;Topics\&quot;: [\&quot;camera1_stream_results\&quot;], \&quot;Type\&quot;: \&quot;zmq_tcp\&quot;}]}, \&quot;/EtcdUI/config\&quot;: {}, \&quot;/EtcdUI/interfaces\&quot;: {}, \&quot;/GlobalEnv/\&quot;: {\&quot;C_LOG_LEVEL\&quot;: \&quot;DEBUG\&quot;, \&quot;ETCD_KEEPER_PORT\&quot;: \&quot;7070\&quot;, \&quot;GO_LOG_LEVEL\&quot;: \&quot;INFO\&quot;, \&quot;GO_VERBOSE\&quot;: \&quot;0\&quot;, \&quot;PY_LOG_LEVEL\&quot;: \&quot;DEBUG\&quot;}, \&quot;/VideoAnalytics/config\&quot;: {\&quot;encoding\&quot;: {\&quot;level\&quot;: 95, \&quot;type\&quot;: \&quot;jpeg\&quot;}, \&quot;max_jobs\&quot;: 20, \&quot;max_workers\&quot;: 4, \&quot;queue_size\&quot;: 10, \&quot;udfs\&quot;: [{\&quot;device\&quot;: \&quot;CPU\&quot;, \&quot;model_bin\&quot;: \&quot;common/udfs/python/pcb/ref/model_2.bin\&quot;, \&quot;model_xml\&quot;: \&quot;common/udfs/python/pcb/ref/model_2.xml\&quot;, \&quot;name\&quot;: \&quot;pcb.pcb_classifier\&quot;, \&quot;ref_config_roi\&quot;: \&quot;common/udfs/python/pcb/ref/roi_2.json\&quot;, \&quot;ref_img\&quot;: \&quot;common/udfs/python/pcb/ref/ref.png\&quot;, \&quot;type\&quot;: \&quot;python\&quot;}]}, \&quot;/VideoAnalytics/interfaces\&quot;: {\&quot;Publishers\&quot;: [{\&quot;AllowedClients\&quot;: [\&quot;*\&quot;], \&quot;EndPoint\&quot;: \&quot;0.0.0.0:65013\&quot;, \&quot;Name\&quot;: \&quot;default\&quot;, \&quot;Topics\&quot;: [\&quot;camera1_stream_results\&quot;], \&quot;Type\&quot;: \&quot;zmq_tcp\&quot;}], \&quot;Subscribers\&quot;: [{\&quot;EndPoint\&quot;: \&quot;/EII/sockets\&quot;, \&quot;Name\&quot;: \&quot;default\&quot;, \&quot;PublisherAppName\&quot;: \&quot;VideoIngestion\&quot;, \&quot;Topics\&quot;: [\&quot;camera1_stream\&quot;], \&quot;Type\&quot;: \&quot;zmq_ipc\&quot;, \&quot;zmq_recv_hwm\&quot;: 50}]}, \&quot;/VideoIngestion/config\&quot;: {\&quot;encoding\&quot;: {\&quot;level\&quot;: 95, \&quot;type\&quot;: \&quot;jpeg\&quot;}, \&quot;ingestor\&quot;: {\&quot;loop_video\&quot;: true, \&quot;pipeline\&quot;: \&quot;./test_videos/pcb_d2000.avi\&quot;, \&quot;poll_interval\&quot;: 0.2, \&quot;queue_size\&quot;: 10, \&quot;type\&quot;: \&quot;opencv\&quot;}, \&quot;max_jobs\&quot;: 20, \&quot;max_workers\&quot;: 4, \&quot;sw_trigger\&quot;: {\&quot;init_state\&quot;: \&quot;running\&quot;}, \&quot;udfs\&quot;: [{\&quot;n_left_px\&quot;: 1000, \&quot;n_right_px\&quot;: 1000, \&quot;n_total_px\&quot;: 300000, \&quot;name\&quot;: \&quot;pcb.pcb_filter\&quot;, \&quot;scale_ratio\&quot;: 4, \&quot;training_mode\&quot;: \&quot;false\&quot;, \&quot;type\&quot;: \&quot;python\&quot;}]}, \&quot;/VideoIngestion/interfaces\&quot;: {\&quot;Publishers\&quot;: [{\&quot;AllowedClients\&quot;: [\&quot;VideoAnalytics\&quot;, \&quot;Visualizer\&quot;, \&quot;WebVisualizer\&quot;, \&quot;TLSRemoteAgent\&quot;, \&quot;RestDataExport\&quot;], \&quot;EndPoint\&quot;: \&quot;/EII/sockets\&quot;, \&quot;Name\&quot;: \&quot;default\&quot;, \&quot;Topics\&quot;: [\&quot;camera1_stream\&quot;], \&quot;Type\&quot;: \&quot;zmq_ipc\&quot;}], \&quot;Servers\&quot;: [{\&quot;AllowedClients\&quot;: [\&quot;*\&quot;], \&quot;EndPoint\&quot;: \&quot;127.0.0.1:66013\&quot;, \&quot;Name\&quot;: \&quot;default\&quot;, \&quot;Type\&quot;: \&quot;zmq_tcp\&quot;}]}}&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<blockquote>
<div><p>For the full JSON schema, see <code class="docutils literal notranslate"><span class="pre">modules/AzureBridge/config_schema.json</span></code>
For the digital twin of the Azure Bridge module.</p>
</div></blockquote>
<p>Each key in the configuration above is described in the table below.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Key</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">log_level</span></code></p></td>
<td><p>This is the logging level for the Azure Bridge module, must be INFO, DEBUG, WARN, or ERROR</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">topics</span></code></p></td>
<td><p>Configuration for the topics to map from the OEI Message Bus into the Azure IoT Edge Runtime</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">eii_config</span></code></p></td>
<td><p>Entire serialized configuration for OEI; this configuration will be placed in ETCD</p></td>
</tr>
</tbody>
</table>
<p>You will notice that the <code class="docutils literal notranslate"><span class="pre">eii_config</span></code> is a serialized JSON string. This is due to a limitation with the Azure IoT Edge Runtime. Currently, module digital twins do not support arrays; however, the OEI configuration requires array support. To workaround this limitation, the OEI configuration must be a serialized JSON string in the digital twin for the Azure Bridge module.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">topics</span></code> value is a JSON object, where each key is a topic from the OEI Message Bus which will be re-published onto the Azure IoT Edge Runtime. The value for the topic key will be an additional JSON object, where there is one required key, <code class="docutils literal notranslate"><span class="pre">az_output_topic</span></code>, which is the topic on Azure IoT Edge Runtime to use and then an optional key, <code class="docutils literal notranslate"><span class="pre">az_blob_container_name</span></code>.</p>
</section>
<section id="sample-oei-onnx-udf">
<h3>Sample OEI ONNX UDF<a class="headerlink" href="#sample-oei-onnx-udf" title="Permalink to this headline">¶</a></h3>
<p>OEI provides a sample UDF which utilizes the ONNX RT to execute your machine learning or deep learning model. It also supports connecting to an AzureML Workspace to download the model and then run it. The source code for this UDF is in <code class="docutils literal notranslate"><span class="pre">[WORKDIR]/IEdgeInsights/common/video/udfs/python/sample_onnx/</span></code>, also refer <code class="docutils literal notranslate"><span class="pre">Sample</span> <span class="pre">ONNX</span> <span class="pre">UDF</span></code> section in <code class="docutils literal notranslate"><span class="pre">[WORKDIR]/IEdgeInsights/common/video/udfs/README.md</span></code> for doing the required configuration for running this UDF.</p>
<p>To use this UDF with OEI, you need to modify your <code class="docutils literal notranslate"><span class="pre">build/eii_config.json</span></code>configuration file to run the UDF in either your Video Ingesiton or Video Analytics instance. Ensure to remove the existing PCB filter or classifier UDFs or any other UDFs in Video Ingestion and Video Analytics config keys in <code class="docutils literal notranslate"><span class="pre">build/eii_config.json</span></code> aswe are doing some basic pre-processing, inferencing and post-processing in the ONNX UDF itself. Then, you need to modify the environmental variables in the <code class="docutils literal notranslate"><span class="pre">AzureBridge/.env</span></code> file to provide the connection
information to enable the UDF to download your model from AzureML. Make sure to follow the instructions provided in the <a class="reference external" href="#setting-up-azureml">Setting up AzureML</a> section above to configure your workspace correctly so that the UDF can download your model.</p>
<p>The sample ONNX UDF requires that the following configuration values be set for the UDF in your <code class="docutils literal notranslate"><span class="pre">eii_config.json</span></code> file:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Key</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">aml_ws</span></code></p></td>
<td><p>AzureML workspace name</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">aml_subscription_id</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">subscriptionId</span></code> saved from creating the Service Principal Authentication</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">model_name</span></code></p></td>
<td><p>Name of the model in your AzureML workspace</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">download_mode</span></code></p></td>
<td><p>Whether or not to attempt to download the model</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If <code class="docutils literal notranslate"><span class="pre">download_mode</span></code> is <code class="docutils literal notranslate"><span class="pre">false</span></code>, then it expects the <code class="docutils literal notranslate"><span class="pre">model_name</span></code> to where the <code class="docutils literal notranslate"><span class="pre">*.onnx</span></code> model file is in the container.</p>
</div>
<p>This should be added into the <code class="docutils literal notranslate"><span class="pre">udfs</span></code> list for your Video Ingestion or Video Analytics instance you wish to have run the UDF. The configuration should look similar to the following:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="c1">// ... omited rest of OEI configuration ...</span>

    <span class="s2">&quot;udfs&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;sample_onnx.onnx_udf&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;python&quot;</span><span class="p">,</span>
            <span class="s2">&quot;aml_ws&quot;</span><span class="o">:</span> <span class="s2">&quot;example-azureml-workspace&quot;</span><span class="p">,</span>
            <span class="s2">&quot;aml_subscription_id&quot;</span><span class="o">:</span> <span class="s2">&quot;subscription-id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;model_name&quot;</span><span class="o">:</span> <span class="s2">&quot;example-model-name&quot;</span><span class="p">,</span>
            <span class="s2">&quot;download_model&quot;</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">}</span>
    <span class="p">]</span>

    <span class="c1">// ... omited rest of OEI configuration ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The following environmental variables must be set in the <code class="docutils literal notranslate"><span class="pre">AzureBridge/.env</span></code> file in order to have the sample ONNX UDF download your model from an AzureML Workspace:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Setting</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">AML_TENANT_ID</span></code></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">tenantId</span></code> saved in the Azure Cloud setup</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">AML_PRINCIPAL_ID</span></code></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">clientId</span></code> saved in the Azure Cloud setup</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">AML_PRINCIPAL_PASS</span></code></p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">clientSecret</span></code> saved in the Azure Cloud setup</p></td>
</tr>
</tbody>
</table>
<p>It is important to note that for the <code class="docutils literal notranslate"><span class="pre">AML_PRINCIPAL_PASS</span></code> variable you must wrap the password in single quotes, i.e. <code class="docutils literal notranslate"><span class="pre">'</span></code>. Otherwise, there may be characters that get escaped in a weird way when the values are populated into your deployment manifest leading to configuration errors.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">tenantId</span></code>, <code class="docutils literal notranslate"><span class="pre">clientId</span></code>, <code class="docutils literal notranslate"><span class="pre">clientSecret</span></code>, and <code class="docutils literal notranslate"><span class="pre">subscriptionId</span></code> should all have been obtained when following the instructions in the <a class="reference external" href="#setting-up-azureml">Setting up AzureML</a>
section.</p>
<p>Run the below steps when the <code class="docutils literal notranslate"><span class="pre">sample_onnx</span></code> UDF is failing with error like <code class="docutils literal notranslate"><span class="pre">The</span> <span class="pre">provided</span> <span class="pre">client</span> <span class="pre">secret</span> <span class="pre">keys</span> <span class="pre">are</span> <span class="pre">expired.</span> <span class="pre">Visit</span> <span class="pre">the</span> <span class="pre">Azure</span> <span class="pre">Portal</span> <span class="pre">to</span> <span class="pre">create</span> <span class="pre">new</span> <span class="pre">keys</span> <span class="pre">for</span> <span class="pre">your</span> <span class="pre">app</span></code>:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>az login
az ad sp create-for-rbac --sdk-auth --name ml-auth
</pre></div>
</div>
<p>The output of above command will be in json format. Please update the <code class="docutils literal notranslate"><span class="pre">AML_</span></code> env variables in <code class="docutils literal notranslate"><span class="pre">AzureBridge/.env</span></code> as per above table and follow the steps <a class="reference external" href="#step-4-deployment">Step 4</a> and <a class="reference external" href="#step-4-deployment">Step 4</a> to see the <code class="docutils literal notranslate"><span class="pre">sample_onnx</span></code> UDF working fine.</p>
<p><strong>IMPORTANT NOTE:</strong></p>
<p>If your system is behind a proxy, you may run into an issue where the download of your ONNX model from AzureML times out. This may happen even if the proxy is set globally for Docker on your system. To fix this, update your deployment manifest template so that the Video Ingestion and/or Video Analytics containers have the <code class="docutils literal notranslate"><span class="pre">http_proxy</span></code> and <code class="docutils literal notranslate"><span class="pre">https_proxy</span></code> values set. The manifest should look something like the following:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="c1">// ... omitted ...</span>

    <span class="s2">&quot;modules&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;ia_video_ingestion&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="c1">// ... omitted ...</span>

            <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;createOptions&quot;</span><span class="o">:</span> <span class="p">{</span>
                    <span class="s2">&quot;Env&quot;</span><span class="o">:</span> <span class="p">[</span>
                        <span class="c1">// ... omitted ...</span>

                        <span class="s2">&quot;http_proxy=&lt;YOUR PROXY&gt;&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;https_proxy=&lt;YOUR PROXY&gt;&quot;</span><span class="p">,</span>

                        <span class="c1">// ... omitted ...</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="c1">// ... omitted ...</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// ... omitted ...</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="simple-subscriber">
<h3>Simple Subscriber<a class="headerlink" href="#simple-subscriber" title="Permalink to this headline">¶</a></h3>
<p>The Simple Subscriber module provided with the Azure Bridge is a very simple service which only receives messages over the Azure IoT Edge Runtime and prints them to stdout. As such, there is no digital twin required for this module. The only configuration required is that a route be established in the Azure IoT Edge Runtime from the Azure Bridge module to the Simple Subscriber module. This routewill look something like the following in your deployment manifest:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;$schema-template&quot;</span><span class="o">:</span> <span class="s2">&quot;2.0.0&quot;</span><span class="p">,</span>
    <span class="s2">&quot;modulesContent&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="c1">// ... omitted for brevity ...</span>

        <span class="s2">&quot;$edgeHub&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;properties.desired&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;schemaVersion&quot;</span><span class="o">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
                <span class="s2">&quot;routes&quot;</span><span class="o">:</span> <span class="p">{</span>
                    <span class="s2">&quot;BridgeToSimpleSubscriber&quot;</span><span class="o">:</span> <span class="s2">&quot;FROM /messages/modules/AzureBridge/outputs/camera1_stream INTO BrokeredEndpoint(\&quot;/modules/SimpleSubscriber/inputs/input1\&quot;)&quot;</span>
                <span class="p">},</span>
                <span class="s2">&quot;storeAndForwardConfiguration&quot;</span><span class="o">:</span> <span class="p">{</span>
                    <span class="s2">&quot;timeToLiveSecs&quot;</span><span class="o">:</span> <span class="mf">7200</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// ... omitted for brevity ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For more information on establishing routes in the Azure IoT Edge Runtime, see <a class="reference external" href="https://docs.microsoft.com/en-us/azure/iot-edge/module-composition#declare-routes">this documentation</a>.</p>
</section>
<section id="oei-etcd-pre-load">
<h3>OEI ETCD Pre-Load<a class="headerlink" href="#oei-etcd-pre-load" title="Permalink to this headline">¶</a></h3>
<p>The configuration for OEI is given to the Azure Bridge via the <code class="docutils literal notranslate"><span class="pre">eii_config</span></code> key in the module’s digital twin. As specified in the Azure Bridge configuration
section, this must be a serialized string. For the scripts included with the
Azure Bridge for generating your deployment manifest the ETCD pre-load
configuration is stored at <code class="docutils literal notranslate"><span class="pre">config/eii_config.json</span></code>. See the OEI documentation
for more information on populating this file with your desired OEI configuration.
The helper scripts will automatically serialize this JSON file and add it to your
deployment manifest.</p>
</section>
<section id="azure-blob-storage">
<h3>Azure Blob Storage<a class="headerlink" href="#azure-blob-storage" title="Permalink to this headline">¶</a></h3>
<p>The Azure Bridge enables to use of the Azure Blob Storage edge IoT service
from Microsoft. This service can be used to save images from OEI into the blob
storage.</p>
<p>If you wish to have the Azure Blob Storage service save the images to your
host filesystem, then you must do the following:</p>
<ol class="arabic">
<li><p>Create the directory to save the data on your host filesystem, it is recommended to use the following commands:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> <span class="o">[</span>WORK_DIR<span class="o">]</span>/IEdgeInsights/build/.env
sudo mkdir -p /opt/intel/eii/data/azure-blob-storage
sudo chown <span class="si">${</span><span class="nv">EII_UID</span><span class="si">}</span>:<span class="si">${</span><span class="nv">EII_UID</span><span class="si">}</span> /opt/intel/eii/data/azure-blob-storage
</pre></div>
</div>
</li>
<li><p>Next, modify your deployment manifest to alter the bind location which the Azure Blob Storage service uses. To do this, open your <code class="docutils literal notranslate"><span class="pre">*.template.json</span></code> file. Provided you specified the Azure Blob Storage service, you should see something like the following in your deployment manifest template:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;AzureBlobStorageonIoTEdge&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;docker&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;running&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;restartPolicy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;always&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">             </span><span class="nt">&quot;image&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mcr.microsoft.com/azure-blob-storage&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">             </span><span class="nt">&quot;createOptions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                 </span><span class="nt">&quot;User&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;${EII_UID}&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                 </span><span class="nt">&quot;Env&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">                     </span><span class="s2">&quot;LOCAL_STORAGE_ACCOUNT_NAME=$AZ_BLOB_STORAGE_ACCOUNT_NAME&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                     </span><span class="s2">&quot;LOCAL_STORAGE_ACCOUNT_KEY=$AZ_BLOB_STORAGE_ACCOUNT_KEY&quot;</span><span class="w"></span>
<span class="w">                 </span><span class="p">],</span><span class="w"></span>
<span class="w">                 </span><span class="nt">&quot;HostConfig&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                     </span><span class="nt">&quot;Binds&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">                         </span><span class="s2">&quot;az-blob-storage-volume:/blobroot&quot;</span><span class="w"></span>
<span class="w">                     </span><span class="p">]</span><span class="w"></span>
<span class="w">                 </span><span class="p">}</span><span class="w"></span>
<span class="w">             </span><span class="p">}</span><span class="w"></span>
<span class="w">         </span><span class="p">}</span><span class="w"></span>
<span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Change the <code class="docutils literal notranslate"><span class="pre">Binds</span></code> location to the following:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
 <span class="s2">&quot;AzureBlobStorageonIoTEdge&quot;</span><span class="o">:</span> <span class="p">{</span>
         <span class="c1">// ... omitted ...</span>
         <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">{</span>
             <span class="s2">&quot;createOptions&quot;</span><span class="o">:</span> <span class="p">{</span>
                 <span class="c1">// ... omitted ...</span>
                 <span class="s2">&quot;HostConfig&quot;</span><span class="o">:</span> <span class="p">{</span>
                     <span class="s2">&quot;Binds&quot;</span><span class="o">:</span> <span class="p">[</span>
                         <span class="s2">&quot;/opt/intel/eii/data/azure-blob-storage/:/blobroot&quot;</span>
                     <span class="p">]</span>
                 <span class="p">}</span>
             <span class="p">}</span>
         <span class="p">}</span>
     <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Add the <code class="docutils literal notranslate"><span class="pre">az_blob_container_name</span></code> key as below in <code class="docutils literal notranslate"><span class="pre">example.template.json</span></code> file, this specifies the Azure Blob Storage container to store the images from the OEI video analytics pipeline in. If the <code class="docutils literal notranslate"><span class="pre">az_blob_container_name</span></code> key is not specified, then the images will not be saved.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
     <span class="s2">&quot;AzureBridge&quot;</span><span class="o">:</span> <span class="p">{</span>
         <span class="s2">&quot;properties.desired&quot;</span><span class="o">:</span> <span class="p">{</span>
             <span class="c1">// ...</span>
             <span class="s2">&quot;topics&quot;</span><span class="o">:</span> <span class="p">{</span>
                 <span class="s2">&quot;camera1_stream_results&quot;</span><span class="o">:</span> <span class="p">{</span>
                     <span class="s2">&quot;az_output_topic&quot;</span><span class="o">:</span> <span class="s2">&quot;camera1_stream_results&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;az_blob_container_name&quot;</span><span class="o">:</span> <span class="s2">&quot;camera1streamresults&quot;</span>
                 <span class="p">}</span>
             <span class="p">},</span>
             <span class="c1">// ...</span>
         <span class="p">}</span>
     <span class="p">}</span>
 <span class="p">}</span>
</pre></div>
</div>
<blockquote>
<div><p><strong>Important Notes:</strong></p>
<ul class="simple">
<li><p>“Container” in the Azure Blob Storage context is not referencing a Docker container, but rather a storage structure within the Azure Blob Storage instance running on your edge device. For more information on the data structure of Azure Blob Storage, see <a class="reference external" href="https://docs.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction#blob-storage-resources">this link</a>.</p></li>
<li><p>The Azure Blob Storage service places strict requirements on the name of the, “container”, under which it stores blobs. This impacts the value given for the <code class="docutils literal notranslate"><span class="pre">az_blob_container_name</span></code> configuration key. According to the Azure documentation, the name must a valid DNS name adhering to the following rules:</p>
<ul>
<li><p>Container names must start or end with a letter or number, and can contain only letters, numbers, and the dash (-) character.</p></li>
<li><p>Every dash (-) character must be immediately preceded and followed by a letter or number; consecutive dashes are not permitted in container names.</p></li>
<li><p>All letters in a container name must be lowercase.</p></li>
<li><p>Container names must be from 3 through 63 characters long.</p></li>
</ul>
</li>
<li><p>For more information on the name conventions/restrictions for Azure Blob Storage container names, see <a class="reference external" href="https://docs.microsoft.com/en-us/rest/api/storageservices/Naming-and-Referencing-Containers--Blobs--and-Metadata">this</a> page of the Azure documentation.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Ensure to run the <code class="docutils literal notranslate"><span class="pre">iotedgedev</span> <span class="pre">genconfig</span> <span class="pre">-f</span> <span class="pre">example.template.json</span></code> command for the changes to be applied to the actual deployment manifest: <code class="docutils literal notranslate"><span class="pre">./config/example.amd64.json</span></code>/. Follow <a class="reference external" href="#step-4-deployment">Step  4 - Deployment</a> to deploy the azure modules. Run the following command to see the images:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo ls -l /opt/intel/eii/data/azure-blob-storage/BlockBlob/
</pre></div>
</div>
<p>In that directory, you will see a folder for each container. Inside that directory will be the individually saved images.</p>
</li>
<li><p><strong>(OPTIONAL)</strong> For pushing the saved images to Azure portal, update the <code class="docutils literal notranslate"><span class="pre">properties.desired</span></code> key of <a class="reference external" href="https://github.com/open-edge-insights/eii-azure-bridge/blob/master/config/templates/AzureBlobStorageonIOTEdge.template.json">AzureBlobStorageonIOTEdge.template.json</a> as below with the right applicable values:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;properties.desired&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;deviceToCloudUploadProperties&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;uploadOn&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="s2">&quot;cloudStorageConnectionString&quot;</span> <span class="o">:</span> <span class="s2">&quot;&lt;KEY_IN_THE_REQUIRED_CONNECTION_STRING&quot;</span><span class="p">,</span>
        <span class="s2">&quot;storageContainersForUpload&quot;</span><span class="o">:</span><span class="p">{</span>
            <span class="s2">&quot;camera1streamresults&quot;</span><span class="o">:</span> <span class="p">{</span>
                    <span class="s2">&quot;target&quot;</span><span class="o">:</span> <span class="s2">&quot;camera1streamresults&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">},</span>
    <span class="s2">&quot;deviceAutoDeleteProperties&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;deleteOn&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="s2">&quot;deleteAfterMinutes&quot;</span><span class="o">:</span> <span class="mf">5</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Rerun step 4 to redeploy the Azure Blob storage with the above config.</p>
<blockquote>
<div><p><strong>Note:</strong></p>
<ul class="simple">
<li><p>For more information on configuring your Azure Blob Storage instance at the edge, see the documentation for the service <a class="reference external" href="https://docs.microsoft.com/en-us/azure/iot-edge/how-to-store-data-blob">here</a>.</p></li>
<li><p>Also see <a class="reference external" href="https://docs.microsoft.com/en-us/azure/iot-edge/how-to-deploy-blob">this guide</a> as well.</p></li>
</ul>
</div></blockquote>
</li>
</ol>
</section>
<section id="azure-deployment-manifest">
<h3>Azure Deployment Manifest<a class="headerlink" href="#azure-deployment-manifest" title="Permalink to this headline">¶</a></h3>
<p>For more information on creating / modifying Azure IoT Hub deployment manifests, see <a class="reference external" href="https://docs.microsoft.com/en-us/azure/iot-edge/module-composition">this guide</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The source code for this project must be placed under the <code class="docutils literal notranslate"><span class="pre">IEdgeInsights</span></code>
directory in the source code for EII for the various scripts and commands in
this README to work.</p>
</div>
<p>The Azure Bridge serves as a connector between EII and the Microsoft
Azure IoT Edge Runtime ecosystem. It does this by allowing the following
forms of bridging:</p>
<ul class="simple">
<li><p>Publishing of incoming data from EII onto the Azure IoT Edge Runtime bus</p></li>
<li><dl class="simple">
<dt>Storage of incoming images from the EII video analytics pipeline into a</dt><dd><p>local instance of the Azure Blob Storage service</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Translation of configuration for EII from the Azure IoT Hub digital twin</dt><dd><p>for the bridge into ETCD via the EII Configuration Manager APIs</p>
</dd>
</dl>
</li>
</ul>
<p>This code base is structured as an Azure IoT Edge Runtime module. It includes:</p>
<ul class="simple">
<li><dl class="simple">
<dt>Deployment templates for deploying the EII video analytics pipeline with the</dt><dd><p>bridge on top of the Azure IoT Edge Runtime</p>
</dd>
</dl>
</li>
<li><p>The Azure Bridge module</p></li>
<li><dl class="simple">
<dt>A simple subscriber on top of the Azure IoT Edge Runtime for showcasing the</dt><dd><p>end-to-end transmission of data</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Various utilities and helper scripts for deploying and developing on the</dt><dd><p>Azure Bridge</p>
</dd>
</dl>
</li>
</ul>
<p>The following sections will cover the configuration/usage of the Azure
Bridge, the deployment of EII on the Azure IoT Edge Runtime, as well as the
usage of the tools and scripts included in this code base for development.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following sections assume an understanding of the configuration
for EII. It is recommended that you read the main README and User Guide for
EII prior to using this service.</p>
</div>
</section>
</section>
<section id="azure-iot-edge-simulator">
<h2>Azure IoT Edge Simulator<a class="headerlink" href="#azure-iot-edge-simulator" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We are facing issue with <code class="docutils literal notranslate"><span class="pre">iotedgehubdev</span></code> Azure IoT edge simulator tool where we aren’t seeing the modules being deployed. An issue on the same is been raised at <a class="reference external" href="https://github.com/Azure/iotedgehubdev/issues/370">Issue 370</a> and is been followed up.</p>
</div>
<p>Microsoft provides a simluator for the Azure IoT Edge Runtime. During the setup of your development system (covered in the <a class="reference external" href="#development-system-setup">Development System Setup</a>
section), the simulator is automatically installed on your system.</p>
<p>Additionally, the Azure Bridge provides the <code class="docutils literal notranslate"><span class="pre">./tools/run-simulator.sh</span></code> script to easily use the simulator with the bridge.</p>
<p>To do this, follow steps 1 - 3 in the <a class="reference external" href="#single-node-azure-iot-edge-deployment">Single-Node Azure IoT Edge Deployment</a> section above. Then, instead of step 4, run the following command to setup the simulator:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo -E env <span class="s2">&quot;PATH=</span><span class="nv">$PATH</span><span class="s2">&quot;</span> iotedgehubdev setup -c <span class="s2">&quot;&lt;edge-device-connection-string&gt;&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">env</span> <span class="pre">&quot;PATH=$PATH&quot;</span></code> above ensures that the <code class="docutils literal notranslate"><span class="pre">PATH</span></code> env variable set in the regular user context gets exported to <code class="docutils literal notranslate"><span class="pre">sudo</span></code> environment.</p>
</div>
<p>Next, start the simulator with your deployment manifest template using the following command:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>./tools/run-simulator.sh ./example.template.json
</pre></div>
</div>
<p>If everything is running smoothly, you should see messages being printed in the Simple Subscriber service using the following command:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>docker logs -f SimpleSubscriber
</pre></div>
</div>
<p><strong>Important Note:</strong></p>
<p>You <em>cannot</em> run both the Azure IoT Edge Runtime and the simulator simultaneously on the same system. If you are using the same system, first stop the Azure IoT Edge Runtime daemon with the following command:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo iotedge system stop
</pre></div>
</div>
<p>Then, run the simulator as specified above.</p>
</section>
<section id="supported-oei-services">
<h2>Supported OEI Services<a class="headerlink" href="#supported-oei-services" title="Permalink to this headline">¶</a></h2>
<p>Azure Bridge supports the following services:</p>
<ul class="simple">
<li><p>Config Manager Agent</p></li>
<li><p>Video Ingestion</p></li>
<li><p>Video Analytics</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>As <code class="docutils literal notranslate"><span class="pre">Config</span> <span class="pre">Manager</span> <span class="pre">Agent</span></code> responsible for OEI provisioning is deployed as azure module, it becomes essential to have other OEI services to be deployed as azure modules to talk to other OEI azure modules.</p></li>
<li><p>Ensure to add the app names to the <code class="docutils literal notranslate"><span class="pre">SERVICES</span></code> environment key of <code class="docutils literal notranslate"><span class="pre">Config</span> <span class="pre">Manager</span> <span class="pre">Agent</span></code> module template file at <a class="reference external" href="https://github.com/open-edge-insights/eii-core/blob/master/ia_configmgr_agent.template.json">ia_configmgr_agent.template.json</a>.</p></li>
</ul>
</div>
</section>
<section id="additional-resources">
<h2>Additional Resources<a class="headerlink" href="#additional-resources" title="Permalink to this headline">¶</a></h2>
<p>For more resources on Azure IoT Hub and Azure IoT Edge, see the following references:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.microsoft.com/en-us/azure/iot-hub/">Azure IoT Hub</a></p></li>
<li><p><a class="reference external" href="https://docs.microsoft.com/en-us/azure/iot-edge/">Azure IoT Edge</a></p></li>
<li><p><a class="reference external" href="https://docs.microsoft.com/en-us/azure/machine-learning/how-to-deploy-and-where">How to Deploy AzureML Models</a></p></li>
<li><p><a class="reference external" href="https://docs.microsoft.com/en-us/azure/machine-learning/tutorial-1st-experiment-sdk-train">AzureML Tutorial: Train your first ML Model</a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright (c) 2021 Intel Corporation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> OEI</span>
      v: 3.0
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Document Versions</dt>
        
          <dd><a href="/3.0/">3.0</a></dd>
        
          <dd><a href="/2.6/">2.6</a></dd>
        
      </dl>
    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>