<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EII Message Bus C Reference: Developing Protocols</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">EII Message Bus C Reference
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Developing Protocols </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Overview</h2>
<p>Protocols are at the bottom most layer of the EII Message Bus stack. They provide the implementation for the messaging primitives supported by the EII Message Bus. The main tasks expected of a protocol are as follows:</p>
<ol type="1">
<li>Initialize the state of the underlying message library (i.e. ZeroMQ, DDS, etc.)</li>
<li>Implement methods for initializing contexts for publishers, subscribers, services, and service requesters</li>
<li>Implement base methods for sending messages from publishers, services, and service requesters</li>
<li>Implement base methods for receiving messages as blocking, non-blocking, and time out base function calls</li>
<li>Provide the translation between the underlying messaging library's messsage structure to the EII Message Bus's <code><a class="el" href="structmsg__envelope__t.html">msg_envelope_t</a></code> structure</li>
</ol>
<p>All protocols must have a unique protocol name which the EII Message Bus can use to load the protocol based on the <code>type</code> configuration value it is provided. For example, the ZeroMQ TCP protocol uses the identifier <code>zmq_tcp</code>. Using this type name, the EII Message Bus knows how to load the protocol in the <code><a class="el" href="msgbus_8h.html#a1bab6ab62eacb3e27e8964ced64ee4e0">msgbus_initialize()</a></code> method.</p>
<p>Currently, the addition and loading of new protocols must be added directly to the source code for the EII Message Bus. In the future, the message bus will include a feature for dynamically loading protocol plugins. All protocols are expected to have an initialize method which follows the prototype: <code>protocol_t* proto_&lt;type&gt;_initialize(const char* type, config_t* config)</code>. This method is expected to initialize the underlying messaging library using the given <code>config</code> parameter and then return a pointer to a <code><a class="el" href="structprotocol__t.html">protocol_t</a></code> structure which has pointers for all of the various messaging functions. This method must then be added manually to the <code><a class="el" href="msgbus_8h.html#a1bab6ab62eacb3e27e8964ced64ee4e0">msgbus_initialize()</a></code> function in <code>src/msgbus.c</code>.</p>
<p>The <code><a class="el" href="structprotocol__t.html">protocol_t</a></code> structure is defined below.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div><div class="line">    <span class="keywordtype">void</span>* proto_ctx;</div><div class="line">    config_t* config;</div><div class="line"></div><div class="line">    void (*destroy)(<span class="keywordtype">void</span>* ctx);</div><div class="line">    <a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> (*publisher_new)(</div><div class="line">            <span class="keywordtype">void</span>* ctx, <span class="keyword">const</span> <span class="keywordtype">char</span>* topic, <span class="keywordtype">void</span>** pub_ctx);</div><div class="line">    <a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> (*publisher_publish)(</div><div class="line">            <span class="keywordtype">void</span>* ctx, <span class="keywordtype">void</span>* pub_ctx, <a class="code" href="structmsg__envelope__t.html">msg_envelope_t</a>* msg);</div><div class="line">    void (*publisher_destroy)(<span class="keywordtype">void</span>* ctx, <span class="keywordtype">void</span>* pub_ctx);</div><div class="line">    <a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> (*subscriber_new)(</div><div class="line">            <span class="keywordtype">void</span>* ctx, <span class="keyword">const</span> <span class="keywordtype">char</span>* topic, <span class="keywordtype">void</span>** subscriber);</div><div class="line">    void (*recv_ctx_destroy)(<span class="keywordtype">void</span>* ctx, <span class="keywordtype">void</span>* recv_ctx);</div><div class="line">    <a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> (*request)(</div><div class="line">            <span class="keywordtype">void</span>* ctx, <span class="keywordtype">void</span>* service_ctx, <a class="code" href="structmsg__envelope__t.html">msg_envelope_t</a>* message);</div><div class="line">    <a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> (*response)(</div><div class="line">            <span class="keywordtype">void</span>* ctx, <span class="keywordtype">void</span>* service_ctx, <a class="code" href="structmsg__envelope__t.html">msg_envelope_t</a>* message);</div><div class="line">    <a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> (*service_new)(</div><div class="line">            <span class="keywordtype">void</span>* ctx, <span class="keyword">const</span> <span class="keywordtype">char</span>* service_name, <span class="keywordtype">void</span>** service_ctx);</div><div class="line">    <a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> (*service_get)(</div><div class="line">            <span class="keywordtype">void</span>* ctx, <span class="keyword">const</span> <span class="keywordtype">char</span>* service_name, <span class="keywordtype">void</span>** service_ctx);</div><div class="line">    <a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> (*recv_wait)(</div><div class="line">            <span class="keywordtype">void</span>* ctx, <span class="keywordtype">void</span>* recv_ctx, <a class="code" href="structmsg__envelope__t.html">msg_envelope_t</a>** message);</div><div class="line">    <a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> (*recv_timedwait)(</div><div class="line">            <span class="keywordtype">void</span>* ctx, <span class="keywordtype">void</span>* recv_ctx, <span class="keywordtype">int</span> timeout, <a class="code" href="structmsg__envelope__t.html">msg_envelope_t</a>** message);</div><div class="line">    <a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> (*recv_nowait)(</div><div class="line">            <span class="keywordtype">void</span>* ctx, <span class="keywordtype">void</span>* recv_ctx, <a class="code" href="structmsg__envelope__t.html">msg_envelope_t</a>** message);</div><div class="line">} <a class="code" href="structprotocol__t.html">protocol_t</a>;</div></div><!-- fragment --><p>It is expected that this structure is fully populated by a protocol's initialization method. The <code>proto_ctx</code> value should be a pointer to an internal structure representing the state of the protocol which the various functions can use to perform the required tasks. Additionally, the <code>config</code> value should be set to the <code>config</code> variable passed to the initialization function. It is important to note that the returned <code><a class="el" href="structprotocol__t.html">protocol_t</a></code> structure is not responsible for freeing the memory assiciated with the <code>config</code> variable. This is managed by the message bus context object.</p>
<p>For each of the functions in the structure the first <code>ctx</code> parameter will always be the value of the <code>proto_ctx</code> variable.</p>
<p>For more information on the purpose of each of the function pointers in the <code><a class="el" href="structprotocol__t.html">protocol_t</a></code> structure see the <a href="#protocol_t-function-definition"><code>protocol_t</code> Function Definition</a>.</p>
<p>The rest of this section will cover the initial setup of a project to add a new protocol to the EII Message Bus, including the ideal code structure for the C source code file.</p>
<p>For the purposes of this tutorial, the name of the proctol to be added will be named <code>example</code>. To start, create a new header file in the <code>include/eii/msgbus</code> directory and a new C file in the <code>src</code> directory.</p>
<div class="fragment"><div class="line">$ touch include/eii/msgbus/example.h</div><div class="line">$ touch src/example.c</div></div><!-- fragment --> <blockquote class="doxtable">
<p><b>NOTE:</b> The names of the files above should be the name of your protocol. </p>
</blockquote>
<p>Once these files are created, add the following to the <code>example.h</code> file.</p>
<div class="fragment"><div class="line"><span class="comment">// C include guards to prevent multiple definition from files including the</span></div><div class="line"><span class="comment">// header</span></div><div class="line"><span class="preprocessor">#ifndef _EII_MESSAGE_BUS_EXAMPLE_H</span></div><div class="line"><span class="preprocessor">#define _EII_MESSAGE_BUS_EXAMPLE_H</span></div><div class="line"></div><div class="line"><span class="comment">// Add extern C declaration if the code is being included from C++ code</span></div><div class="line"><span class="preprocessor">#ifdef __cplusplus</span></div><div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> {</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="comment">// Include the protocol.h to get the protocol_t and config_t structure</span></div><div class="line"><span class="comment">// definitions</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="protocol_8h.html">eii/msgbus/protocol.h</a>&quot;</span></div><div class="line"></div><div class="line"><a class="code" href="structprotocol__t.html">protocol_t</a>* proto_example_initialize(<span class="keyword">const</span> <span class="keywordtype">char</span>* type, config_t* config);</div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef __cplusplus</span></div><div class="line">}</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="preprocessor">#endif // _EII_MESSAGE_BUS_EXAMPLE_H</span></div></div><!-- fragment --><p>The code above defines the initialization method for initializing the <code>example</code> protocol.</p>
<p>Next, modify the <code>src/msgbus.c</code> file to call the new <code>proto_example_intiialize()</code> method if the type configuration parameter is set to <code>example</code>.</p>
<p>First, include the <code>example.h</code> header file on line 36 in the <code>src/msgbus.c</code> file.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;eii/msgbus/example.h&quot;</span></div></div><!-- fragment --><p>Then, add the following code at after line 210.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> ind_example;</div><div class="line">strcmp_s(value-&gt;body.string, strlen(<span class="stringliteral">&quot;example&quot;</span>), <span class="stringliteral">&quot;example&quot;</span>, &amp;ind_example);</div></div><!-- fragment --><p>Next, extend the <code>if...else...</code> block from lines 212 to 219 to add an <code>else if</code> clause for if the the protocol type is <code>example</code>. The entire code block should look as follows in the end.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span>(ind_ipc == 0 ||ind_tcp == 0) {</div><div class="line"></div><div class="line">    proto = proto_zmq_initialize(value-&gt;body.string, config);</div><div class="line">    <span class="keywordflow">if</span>(proto == NULL)</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">} <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ind_example ==0) {</div><div class="line">    proto = proto_example_initialize(value-&gt;body.string, config);</div><div class="line">    <span class="keywordflow">if</span>(proto == NULL)</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">} <span class="keywordflow">else</span> {</div><div class="line">    LOG_ERROR(<span class="stringliteral">&quot;Unknown protocol type: %s&quot;</span>, value-&gt;body.string);</div><div class="line">    <span class="keywordflow">goto</span> err;</div><div class="line">}</div></div><!-- fragment --><p>Once these steps are completed, switch to the <code>src/example.c</code> file to add the protocol implementation. The recommended structure of the code in this file is shown below.</p>
<p>The code below first defines a set of common header file includes, including the <code>example.h</code> header file. Following this are the function prototypes for all of the needed function pointers in the <code><a class="el" href="structprotocol__t.html">protocol_t</a></code> structure.</p>
<p>After these definitions lies the implementation for the <code>proto_example_initialize()</code> function. The <code>TODO</code> comments represent areas where code must be added depending on the protocol being added to the EII Message Bus. The code then intializes the <code><a class="el" href="structprotocol__t.html">protocol_t</a></code> struct and assigns all of the proper pointers.</p>
<p>After the implementation for the <code>proto_example_initialize()</code> function are all of the function imlementations for the prototypes defined at the top of the file.</p>
<p>Once this file is saved as <code>src/example.c</code>, compile the EII Message Bus. The examples should all work, however, they should immediately return or potentially raise an error, since this is an empty protocol implementation and none of the return objects are being initialized.</p>
<div class="fragment"><div class="line"><span class="comment">// Standard C includes</span></div><div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div><div class="line"></div><div class="line"><span class="comment">// Include the example.h header file</span></div><div class="line"><span class="preprocessor">#include &quot;eii/msgbus/example.h&quot;</span></div><div class="line"></div><div class="line"><span class="comment">// Include the logger.h for helper logging macros</span></div><div class="line"><span class="preprocessor">#include &quot;eii/msgbus/logger.h&quot;</span></div><div class="line"></div><div class="line"><span class="comment">// Function prototypes</span></div><div class="line"><span class="keywordtype">void</span> proto_example_destroy(<span class="keywordtype">void</span>* ctx);</div><div class="line"></div><div class="line"><a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> proto_example_publisher_new(</div><div class="line">        <span class="keywordtype">void</span>* ctx, <span class="keyword">const</span> <span class="keywordtype">char</span>* topic, <span class="keywordtype">void</span>** pub_ctx);</div><div class="line"></div><div class="line"><a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> proto_example_publisher_publish(</div><div class="line">        <span class="keywordtype">void</span>* ctx, <span class="keywordtype">void</span>* pub_ctx, <a class="code" href="structmsg__envelope__t.html">msg_envelope_t</a>* msg);</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> proto_example_publisher_destroy(<span class="keywordtype">void</span>* ctx, <span class="keywordtype">void</span>* pub_ctx);</div><div class="line"></div><div class="line"><a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> proto_example_subscriber_new(</div><div class="line">    <span class="keywordtype">void</span>* ctx, <span class="keyword">const</span> <span class="keywordtype">char</span>* topic, <span class="keywordtype">void</span>** subscriber);</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> proto_example_recv_ctx_destroy(<span class="keywordtype">void</span>* ctx, <span class="keywordtype">void</span>* recv_ctx);</div><div class="line"></div><div class="line"><a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> proto_example_recv_wait(</div><div class="line">        <span class="keywordtype">void</span>* ctx, <span class="keywordtype">void</span>* recv_ctx, <a class="code" href="structmsg__envelope__t.html">msg_envelope_t</a>** message);</div><div class="line"></div><div class="line"><a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> proto_example_recv_timedwait(</div><div class="line">        <span class="keywordtype">void</span>* ctx, <span class="keywordtype">void</span>* recv_ctx, <span class="keywordtype">int</span> timeout, <a class="code" href="structmsg__envelope__t.html">msg_envelope_t</a>** message);</div><div class="line"></div><div class="line"><a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> proto_example_recv_nowait(</div><div class="line">        <span class="keywordtype">void</span>* ctx, <span class="keywordtype">void</span>* recv_ctx, <a class="code" href="structmsg__envelope__t.html">msg_envelope_t</a>** message);</div><div class="line"></div><div class="line"><a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> proto_example_service_get(</div><div class="line">        <span class="keywordtype">void</span>* ctx, <span class="keyword">const</span> <span class="keywordtype">char</span>* service_name, <span class="keywordtype">void</span>** service_ctx);</div><div class="line"></div><div class="line"><a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> proto_example_service_new(</div><div class="line">        <span class="keywordtype">void</span>* ctx, <span class="keyword">const</span> <span class="keywordtype">char</span>* service_name, <span class="keywordtype">void</span>** service_ctx);</div><div class="line"></div><div class="line"><a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> proto_example_request(</div><div class="line">        <span class="keywordtype">void</span>* ctx, <span class="keywordtype">void</span>* service_ctx, <a class="code" href="structmsg__envelope__t.html">msg_envelope_t</a>* msg);</div><div class="line"></div><div class="line"><a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> proto_example_response(</div><div class="line">        <span class="keywordtype">void</span>* ctx, <span class="keywordtype">void</span>* service_ctx, <a class="code" href="structmsg__envelope__t.html">msg_envelope_t</a>* message);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// proto_example_initialize() method implementation</span></div><div class="line"><a class="code" href="structprotocol__t.html">protocol_t</a>* proto_example_initialize(<span class="keyword">const</span> <span class="keywordtype">char</span>* type, config_t* config) {</div><div class="line">    LOG_DEBUG_0(<span class="stringliteral">&quot;Initializing example protocol&quot;</span>);</div><div class="line"></div><div class="line">    <span class="comment">// TODO: Retreive needed configuration values from config</span></div><div class="line"></div><div class="line">    <span class="comment">// TODO: Initialize all the internal state for the protocol here</span></div><div class="line"></div><div class="line">    <span class="comment">// Initialize the protocol_t structure</span></div><div class="line">    <a class="code" href="structprotocol__t.html">protocol_t</a>* proto_ctx = (<a class="code" href="structprotocol__t.html">protocol_t</a>*) malloc(<span class="keyword">sizeof</span>(<a class="code" href="structprotocol__t.html">protocol_t</a>));</div><div class="line">    <span class="keywordflow">if</span>(proto_ctx == NULL) {</div><div class="line">        LOG_ERROR_0(<span class="stringliteral">&quot;Ran out of memory allocating the protocol_t struct&quot;</span>);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// TODO: Replace with setting with the internal context structure for the</span></div><div class="line">    <span class="comment">// protocol initailized prior to this</span></div><div class="line"></div><div class="line">    proto_ctx-&gt;proto_ctx = NULL;</div><div class="line">    proto_ctx-&gt;config = config;</div><div class="line"></div><div class="line">    <span class="comment">// Assign all of the function pointers</span></div><div class="line"></div><div class="line">    proto_ctx-&gt;destroy = proto_example_destroy;</div><div class="line">    proto_ctx-&gt;publisher_new = proto_example_publisher_new;</div><div class="line">    proto_ctx-&gt;publisher_publish = proto_example_publisher_publish;</div><div class="line">    proto_ctx-&gt;publisher_destroy = proto_example_publisher_destroy;</div><div class="line">    proto_ctx-&gt;subscriber_new = proto_example_subscriber_new;</div><div class="line">    proto_ctx-&gt;request = proto_example_request;</div><div class="line">    proto_ctx-&gt;response = proto_example_response;</div><div class="line">    proto_ctx-&gt;service_get = proto_example_service_get;</div><div class="line">    proto_ctx-&gt;service_new = proto_example_service_new;</div><div class="line">    proto_ctx-&gt;recv_ctx_destroy = proto_example_recv_ctx_destroy;</div><div class="line">    proto_ctx-&gt;recv_wait = proto_example_recv_wait;</div><div class="line">    proto_ctx-&gt;recv_timedwait = proto_example_recv_timedwait;</div><div class="line">    proto_ctx-&gt;recv_nowait = proto_example_recv_nowait;</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> proto_ctx;</div><div class="line"></div><div class="line">    <span class="comment">// It is recommended to have a single error goto location that cleans up</span></div><div class="line">    <span class="comment">// all allocated memory if an error occurs.</span></div><div class="line">err:</div><div class="line">    <span class="keywordflow">return</span> NULL;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// proto_* function implementations</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> proto_example_destroy(<span class="keywordtype">void</span>* ctx) {</div><div class="line">    LOG_DEBUG_0(<span class="stringliteral">&quot;Destroying example protocol context&quot;</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> proto_example_publisher_new(</div><div class="line">        <span class="keywordtype">void</span>* ctx, <span class="keyword">const</span> <span class="keywordtype">char</span>* topic, <span class="keywordtype">void</span>** pub_ctx)</div><div class="line">{</div><div class="line">    LOG_DEBUG(<span class="stringliteral">&quot;Initializing publisher for topic &#39;%s&#39;&quot;</span>, topic);</div><div class="line"></div><div class="line">    <span class="comment">// TODO: Intialize publisher</span></div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> MSG_SUCCESS;</div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> proto_example_publisher_publish(</div><div class="line">        <span class="keywordtype">void</span>* ctx, <span class="keywordtype">void</span>* pub_ctx, <a class="code" href="structmsg__envelope__t.html">msg_envelope_t</a>* msg)</div><div class="line">{</div><div class="line">    <span class="comment">// TODO: Implement publishing a message</span></div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> MSG_SUCCESS;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> proto_example_publisher_destroy(<span class="keywordtype">void</span>* ctx, <span class="keywordtype">void</span>* pub_ctx) {</div><div class="line">    LOG_DEBUG_0(<span class="stringliteral">&quot;Destroying publisher context&quot;</span>);</div><div class="line"></div><div class="line">    <span class="comment">// TODO: Destroy a publisher&#39;s context</span></div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> proto_example_subscriber_new(</div><div class="line">    <span class="keywordtype">void</span>* ctx, <span class="keyword">const</span> <span class="keywordtype">char</span>* topic, <span class="keywordtype">void</span>** subscriber)</div><div class="line">{</div><div class="line">    LOG_DEBUG(<span class="stringliteral">&quot;Initializig subscriber to topic &#39;%s&#39;&quot;</span>, topic);</div><div class="line"></div><div class="line">    <span class="comment">// TODO: Implement subscriber initialization</span></div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> MSG_SUCCESS;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> proto_example_recv_ctx_destroy(<span class="keywordtype">void</span>* ctx, <span class="keywordtype">void</span>* recv_ctx) {</div><div class="line">    LOG_DEBUG_0(<span class="stringliteral">&quot;Destroying receive context&quot;</span>);</div><div class="line">    <span class="comment">// TODO: Implement destroying a receive context</span></div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> proto_example_recv_wait(</div><div class="line">        <span class="keywordtype">void</span>* ctx, <span class="keywordtype">void</span>* recv_ctx, <a class="code" href="structmsg__envelope__t.html">msg_envelope_t</a>** message)</div><div class="line">{</div><div class="line">    <span class="comment">// TODO: Implement blocking receive method</span></div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> MSG_SUCCESS;</div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> proto_example_recv_timedwait(</div><div class="line">        <span class="keywordtype">void</span>* ctx, <span class="keywordtype">void</span>* recv_ctx, <span class="keywordtype">int</span> timeout, <a class="code" href="structmsg__envelope__t.html">msg_envelope_t</a>** message)</div><div class="line">{</div><div class="line">    <span class="comment">// TODO: Implement receive which can timoue</span></div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> MSG_SUCCESS;</div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> proto_example_recv_nowait(</div><div class="line">        <span class="keywordtype">void</span>* ctx, <span class="keywordtype">void</span>* recv_ctx, <a class="code" href="structmsg__envelope__t.html">msg_envelope_t</a>** message)</div><div class="line">{</div><div class="line">    <span class="comment">// TODO: Imeplement non-blocking receive method</span></div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> MSG_SUCCESS;</div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> proto_example_service_get(</div><div class="line">        <span class="keywordtype">void</span>* ctx, <span class="keyword">const</span> <span class="keywordtype">char</span>* service_name, <span class="keywordtype">void</span>** service_ctx)</div><div class="line">{</div><div class="line">    LOG_DEBUG(<span class="stringliteral">&quot;Initializing service request for service &#39;%s&#39;&quot;</span>, service_name);</div><div class="line"></div><div class="line">    <span class="comment">// TODO: Intiailize context for sending requests and receiving responses</span></div><div class="line">    <span class="comment">// for the given service</span></div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> MSG_SUCCESS;</div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> proto_example_service_new(</div><div class="line">        <span class="keywordtype">void</span>* ctx, <span class="keyword">const</span> <span class="keywordtype">char</span>* service_name, <span class="keywordtype">void</span>** service_ctx)</div><div class="line">{</div><div class="line">    LOG_DEBUG(<span class="stringliteral">&quot;Initializing service &#39;%s&#39; context&quot;</span>, service_name);</div><div class="line"></div><div class="line">    <span class="comment">// TODO: Initailize a service context</span></div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> MSG_SUCCESS;</div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> proto_example_request(</div><div class="line">        <span class="keywordtype">void</span>* ctx, <span class="keywordtype">void</span>* service_ctx, <a class="code" href="structmsg__envelope__t.html">msg_envelope_t</a>* msg)</div><div class="line">{</div><div class="line">    <span class="comment">// NOTE: Becareful here that the service context is the correct one and</span></div><div class="line">    <span class="comment">// is not for receiving responses</span></div><div class="line"></div><div class="line">    <span class="comment">// TODO: Implement issuing a request to the service with the given</span></div><div class="line">    <span class="comment">// service context</span></div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> MSG_SUCCESS;</div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="msgbusret_8h.html#a3da2df17711d823cf8411e3433c01cc4">msgbus_ret_t</a> proto_example_response(</div><div class="line">        <span class="keywordtype">void</span>* ctx, <span class="keywordtype">void</span>* service_ctx, <a class="code" href="structmsg__envelope__t.html">msg_envelope_t</a>* message)</div><div class="line">{</div><div class="line">    <span class="comment">// NOTE: Becareful here that the service context is the correct one and</span></div><div class="line">    <span class="comment">// is not for receiving responses</span></div><div class="line"></div><div class="line">    <span class="comment">// TODO: Implement sending a response to a request</span></div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> MSG_SUCCESS;</div><div class="line">}</div></div><!-- fragment --><h2><code><a class="el" href="structprotocol__t.html">protocol_t</a></code> Function Definition</h2>
<p>The following describes the purpose of each of the function pointers above.</p>
<h3><code>destroy()</code></h3>
<p>Responsible for destroying the <code>proto_ctx</code> variable and freeing any memory used by the context.</p>
<h3><code>publisher_new()</code></h3>
<p>Initializes a new publisher context for the given <code>topic</code>.</p>
<h3><code>publisher_publish()</code></h3>
<p>Publishes the given message value using the publisher context.</p>
<h3><code>publisher_destroy()</code></h3>
<p>Destroys a context for a publisher freeing any sockets, memory, etc. used by the publisher.</p>
<h3><code>subscriber_new()</code></h3>
<p>Subscribe to the given topic and output a <code><a class="el" href="structrecv__ctx__t.html">recv_ctx_t</a></code> to use with the <code>recv_*</code> methods to receive the publications for the topic.</p>
<h3><code>service_new()</code></h3>
<p>Create a new <code><a class="el" href="structrecv__ctx__t.html">recv_ctx_t</a></code> structure which can be used to received requests from clients and send responses to received requests using the <code>response()</code> method.</p>
<h3><code>service_get()</code></h3>
<p>Create a new <code><a class="el" href="structrecv__ctx__t.html">recv_ctx_t</a></code> structure which can be used to issue requests to and received responses from the specified service.</p>
<h3><code>recv_ctx_destroy()</code></h3>
<p>Destroy a <code><a class="el" href="structrecv__ctx__t.html">recv_ctx_t</a></code> structure.</p>
<h3><code>request()</code></h3>
<p>Issue a request to the service using the given <code><a class="el" href="structrecv__ctx__t.html">recv_ctx_t</a></code>.</p>
<h3><code>response()</code></h3>
<p>Send a response to a requesting client using the given <code><a class="el" href="structrecv__ctx__t.html">recv_ctx_t</a></code> structure.</p>
<h3><code>recv_wait()</code></h3>
<p>Blocking function for receiving a message from a <code><a class="el" href="structrecv__ctx__t.html">recv_ctx_t</a></code> context structure.</p>
<h3><code>recv_timedwait()</code></h3>
<p>Function for receiving messages from a <code><a class="el" href="structrecv__ctx__t.html">recv_ctx_t</a></code> context structure which times out after the given timeout. The timeout shall always be milliseconds.</p>
<h3><code>recv_nowait()</code></h3>
<p>Receive a message from a <code><a class="el" href="structrecv__ctx__t.html">recv_ctx_t</a></code> context structure if a message is available, otherwise return immediately. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
